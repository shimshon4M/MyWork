<?xml version="1.0" ?>
<root>
  <jtitle>対をなす二文書間における文対応関係の推定</jtitle>
  <jauthor>角田孝昭乾孝司山本幹雄</jauthor>
  <jabstract>本論文では，手紙文書とそれに対する応答文書など対となる二つの文書間における文レベルでの対応関係を推定する課題を提案し，解決手法を検討する．これまで，単一の文書内における文同士の関係や対話における発話同士の関係を対象とした研究は盛んに行われて来たのに対し，二文書間における文書を跨いだ文対応関係にはあまり注目されて来なかった．このような関係の例として，質問と応答，依頼と回答などが挙げられる．文対応関係を用いることで文書によるコミュニケーションをより細かい単位で説明できることから，本関係の推定が実現すれば様々な応用が期待できる．一例として，文書対の群から対応を持つ文を抽出すれば，各文書対でどのようなコミュニケーションが行われているかを提示することが可能となる．我々は文対応関係の自動推定を実現するため，本課題を文対応の有無を判定する分類問題とみなして条件付確率場を用いる手法を提案する．具体的には，推定した文の種類を文対応推定に活用する対話文書を対象とした従来手法を，本論文の課題に適用する手法を示す．加えて，文種類の推定と文対応の推定を同時に行う拡張モデルによる手法を提案する．実際の宿泊予約ウェブサイトにおけるレビュー・返答対を対象とした評価実験の結果，拡張モデルは拡張前のモデルよりも高い性能である適合率46.6%,再現率61.0%の推定性能を得た．</jabstract>
  <jkeywords>二文書，文間関係，談話分析，条件付確率場</jkeywords>
  <subsection title="Qu &amp; Liu による文依存関係推定手法の概要">Qu&amp;Liuが提案した対話文書における文依存関係を推定する手法では，文種類推定器と文依存関係分類器の二種類を用意する．そこで，最初に文種類推定器について説明し，次に文依存関係分類器について説明する．ここで，説明のために以下の記号を導入する．ここで，y_i,jは対話文x_iからx_jの間に文依存関係が存在すれば1，しなければ0の二値を取る変数である．各文の種類を推定する問題は，文xを観測変数，文種類tを隠れ変数と考えると，系列ラベリング問題とみなすことができる．そこで，彼らはLinear-chainCRFを利用することで文種類推定器を実現する．各文間の文対応を推定する問題も，文xを観測変数，文依存関係yを隠れ変数としたラベリング問題と考えることができる．ここで，予め文種類推定器により推定した文種類tを素性の一つに投入することで，文種類を考慮した文依存関係の推定を実現する．ただし，文依存関係yは文種類系列とは異なり二次元の構造を持つため，このままでは一次元の系列を対象とするLinear-chainCRFを用いることはできない．そこで，彼らは二次元構造の行ごとに順次推定を行うことでLinear-chainCRFを適用する手法と，二次元構造を一度に推定できる2DCRFを適用する手法を提案している．Linear-chainCRFを繰り返し適用して文依存関係を推定する過程を図に示す．まず最初に注目する文x_k~(1kN)を固定し，x_kから全てのx_1,x_2,x_Nへの文依存関係y_k,[f]~(1[f]N)について考える．これにより，y_k,[f]は一次元の系列となるため，Linear-chainCRFを適用可能になる．この処理を全てのx_kに対して繰り返し適用することで，y全体の推定が実現する．このLinear-chainCRFにおいては連接確率P(y_i,j|y_i,j-1,x)が考慮されることになる．これにより，依存元が同じで依存先が隣接するy_i,j,y_i,j-1の片方が依存関係にあればもう片方にも依存関係が存在することが多い傾向を活用できる,y_i-1,jの連接性についても，Linear-chainCRFをy_[f],jに順次適用することで考慮でき結果として全体の推定が実現するが，Qu&amp;Liuはこの場合については検討を行っていない．本論文が対象とする文対応推定の際には，この場合に相当する文対応推定器も作成して性能の比較検討を行う．．これに対し，2DCRFを適用して推定する手法ではy全体を一度に推定できる．ここで2DCRFについて，2DCRFを因子グラフで表現した図を用いて説明する．Linear-chainCRFを繰り返し適用する手法は，図の因子のうち各yを横方向y_i,j,y_i,j-1を結ぶ因子のみを残した場合に相当し，各行y_i,[f]ごとに推定を行う．一方2DCRFでは，各yを縦方向y_i,j,y_i-1,jに結ぶ因子が加わる．これにより，Linear-chainCRFでは依存元が同じで依存先が隣接するy_i,j,y_i,j-1の連接性のみを考慮していたが，依存先が同じで依存元が隣接するy_i-1,j,y_i,jについての連接性も同時に考慮されるようになる．Qu&amp;Liuによると，2DCRFによる文依存推定モデルの方がLinear-chainCRFを繰り返し適用する推定モデルよりも性能が向上したことを報告している．</subsection>
  <section title="はじめに">今日までに，人間による言語使用の仕組みを解明する試みが単語・文・発話・文書など様々な単位に注目して行われて来た．特に，これらの種類や相互関係（例えば単語であれば品詞や係り受け関係，文であれば文役割や修辞構造など）にどのようなものがあるか，どのように利用されているかを明らかにする研究が精力的になされて来た．計算機が普及した現代では，これらを数理モデル化して考えることで自動推定を実現する研究も広く行われており，言語学的な有用性にとどまらず様々な工学的応用を可能にしている．例えば，ある一文書内に登場する節という単位に注目すると，主な研究としてMann&amp;Thompsonによる修辞構造理論(RhetoricalStructureTheory;RST)がある．修辞構造理論では文書中の各節が核(nucleus)と衛星(satelite)の2種類に分類できるとし，さらに核と衛星の間にみられる関係を21種類に，核と核の間にみられる関係（多核関係）を3種類に分類している．このような分類を用いて，節同士の関係を自動推定する研究も古くから行われている．さらに，推定した関係を別タスクに利用する研究も盛んに行われている．例えば，MarcuMarcu99discoursetrees・比留間ら比留間正樹:1999-07-10・平尾ら平尾:2013は，節の種類や節同士の関係を手がかりに重要と考えられる文のみを選択することで自動要約への応用を示している．また，MarcuらMarcu2000・Tuらtu-zhou-zong:2013:Shortは，機械翻訳においてこれらの情報を考慮することで性能向上を実現している．一方，我々は従来研究の主な対象であった一文書や対話ではなく，ある文書（往信文書）とそれに呼応して書かれた文書（返信文書）の対を対象とし，往信文書中のある文と返信文書中のある文との間における文レベルでの呼応関係（以下，文対応と呼ぶ）に注目する．このような文書対の例として「電子メールと返信」，「電子掲示板の投稿と返信」，「ブログコメントの投稿と返信」，「質問応答ウェブサイトの質問投稿と応答投稿」，「サービスや商品に対するレビュー投稿とサービス提供者の返答投稿」などがあり，様々な文書対が存在する（なお，本論文において文書対は異なる書き手によって書かれたものとする）．具体的に文書対として最も典型的な例であるメール文書と返信文書における実際の文対応の例を図に示す．図中の文同士を結ぶ直線が文対応を示しており，例えば返信文「講義を楽しんで頂けて何よりです。」は往信文「本日の講義も楽しく拝聴させて頂きました。」を受けて書かれた文である．同様に，返信文「まず、課題提出日ですが…」と「失礼しました。」はいずれも往信文「また、課題提出日が…」を受けて書かれた文である．本論文では，文書レベルで往信・返信の対応が予め分かっている文書対を入力とし，以上に述べたような文対応を自動で推定する課題を新たに提案し，解決方法について検討する．これら文書対における文対応の自動推定が実現すれば，様々な応用が期待できる点で有用である．応用例について，本研究の実験では「サービスに対するレビュー投稿とサービス提供者の返答投稿」を文書対として用いているため，レビュー文書・返答文書対における文対応推定の応用例を中心に説明する．文書対群の情報整理：複数の文書対から，文対応が存在する文対のみを抽出することでこれら文書対の情報整理が可能になる．例えば，「このサービス提供者は（または要望，苦情など）に対してこのように対応しています」といった一覧を提示できる．これを更に応用すれば，将来的にはFAQの（半）自動生成や，要望・苦情への対応率・対応傾向の提示などへ繋げられると考えている．未対応文の検出による返信文書作成の支援：往信文書と返信文書を入力して自動で文対応を特定できるということは，逆に考えると往信文書の中で対応が存在しない文が発見できることでもある．この推定結果を利用し，ユーザが返信文書を作成している際に「往信文書中の対応がない文」を提示することで，返信すべき事項に漏れがないかを確認できる文書作成支援システムが実現できる．このシステムは，レビュー文書・返答文書対に適用した場合は顧客への質問・クレームへの対応支援に活用できる他，例えば質問応答サイトのデータに適用した場合は応答作成支援などにも利用できる．定型的返信文の自動生成：(2)の考えを更に推し進めると，文対応を大量に収集したデータを用いることで，将来的には定型的な返信文の自動生成が可能になると期待できる．大規模な文対応データを利用した自動生成手法は，例えばRitterら・長谷川らが提案しているが，いずれも文対応が既知のデータ（これらの研究の場合はマイクロブログの投稿と返信）の存在が前提である．しかし，実際には文対応が既知のデータは限られており，未知のデータに対して自動生成が可能となるだけの分量を人手でタグ付けするのは非常に高いコストを要する．これに対し，本研究が完成すればレビュー文書・返答文書対をはじめとした文対応が未知のデータに対しても自動で文対応を付与できるため，先に挙げた様々な文書において往信文からの定型的な返信文の自動生成システムが実現できる．定型的な返信文には，挨拶などに加え，同一の書き手が過去に類似した質問や要望に対して繰り返し同様の返信をしている場合などが含まれる．非定形的返信文の返答例提示：(3)の手法の場合，自動生成できるのは定型的な文に限られる．一方，例えば要望や苦情などの個別案件に対する返答文作成の支援は，完全な自動生成の代わりに複数の返答例を提示することで実現できると考えている．これを実現する方法として，現在返答しようとしている往信文に類似した往信文を文書対のデータベースから検索し，類似往信文と対応している返信文を複数提示する手法がある．返信文の書き手は，返答文例の中から書き手の方針と合致したものを利用ないし参考にすることで返信文作成の労力を削減できる．一方で，文書対における文対応の自動推定課題は以下のような特徴を持つ．対応する文同士は必ずしも類似しない：例えば図の例で，往信文「本日の講義も楽しく拝聴させて頂きました。」と返信文「講義を楽しんで頂けて何よりです。」は「講義」という単語を共有しているが，往信文「また、課題提出日が…」と返信文「失礼しました。」は共有する単語を一つも持たないにも関わらず文対応が存在する．このように，文対応がある文同士は必ずしも類似の表現を用いているとは限らない．そのため，単純な文の類似度によらない推定手法が必要となる．文の出現順序と文対応の出現位置は必ずしも一致しない：例えば図の例で対応が逆転している（文対応を示す直線が交差している）ように，返信文書の書き手は往信文書の並びと対応させて返信文書を書くとは限らない．そのため，文書中の出現位置に依存しない推定手法が必要となる．我々は，以上の特徴を踏まえて文対応の自動推定を実現するために，本課題を文対応の有無を判定する二値分類問題と考える．すなわち，存在しうる全ての文対応（例えば図であれば66=36通り）のそれぞれについて文対応が存在するかを判定する分類器を作成する．本論文では，最初にQu&amp;Liuの対話における発話の対応関係を推定する手法を本課題に適用する．彼らは文種類（対象が質問応答なので「挨拶」「質問」「回答」など）を推定した後に，この文種類推定結果を発話文対応推定の素性として用いることで高い性能で文対応推定が実現したことを報告している．本論文ではこれに倣って文種類の推定結果を利用した文対応の推定を行うが，我々の対象とする文書対とは次のような点で異なっているため文種類・文対応の推定手法に多少の変更を加える．すなわち，彼らが対象とする対話では対応関係が有向性を持つが，我々が対象とする文書対では返信文から往信文へ向かう一方向のみである．また，対話は発話の連鎖で構成されているが，文書対は一組の往信文書・返信文書の対で構成されている点でも異なる．更に，我々は文対応の推定性能をより向上させるために，彼らの手法を発展させた新たな推定モデルを提案する．彼らの手法では，文対応の素性に推定された文種類を利用しているが，文種類推定に誤りが含まれていた場合に文対応推定結果がその誤りに影響されてしまう問題がある．そこで，我々は文種類と文対応を同時に推定するモデルを提案し，より高い性能で文対応の推定が実現できることを示す．本論文の構成は次の通りである．まず，2章で関連研究について概観する．次に，3章で文対応の自動推定を行う提案手法について述べる．4章では評価実験について述べる．5章で本論文のまとめを行う．</section>
  <section title="関連研究">二文書以上の文書間において，文書を跨いだ文同士の関係に踏み込んだ研究は新聞記事を対象としたものが多い．Radevは新聞記事間に観察できる文間関係を「同等(Equivalence)」「反対(Contradiction)」など24種類に分類するCross-DocumentStructureTheoryを提案した．これら文間関係のうち，宮部らは「同等」「推移」関係の特定に，難波らは「推移」「更新」関係の特定に特化した自動推定手法を提案している．これらの各研究では「同等」「推移」「更新」関係を特定するために文同士が類似しているなどの特徴を利用している．これらの研究と我々の研究を比較すると，まず，これらの研究が扱う新聞記事間における文対応と我々が扱う往信-返信文書間における文対応は異なった傾向を持っている．すなわち，新聞記事では同じ事象に対して複数の書き手が記事を作成したり，事象の経過により状況が異なったりすることで文書間や文書を跨いだ文間に対応が発生するのに対し，往信-返信文書ではコミュニケーションという目的を達成するために文対応が発生するという違いがある．また，我々が対象としている往信-返信文書対における文対応では，先に見た通り類似しない文同士にも文対応が存在することもあり，対応する文同士が類似していることを前提にせずに推定を行う必要がある．新聞記事以外では，地方自治体間の条例を対象とした研究，料理レシピと対応するレビュー文書を対象とした研究がある．竹中・若尾は地方自治体間で異なる条例を条文単位で比較する条文対応表を作成するために，条文間の対応を自動で推定する手法を提案している．またDruck&amp;Pangは，レシピに対応するレビュー文書に含まれる作り方や材料に対する改善提案文の抽出を目的とし，その最終過程で提案文をレシピの手順と対応付ける手法を提案している．ただし，推定するべき対応が類似していることを前提としている（すなわち，竹中・若尾の場合は同一の事柄に関する条例を対応付ける手法であり，Druck&amp;Pangの場合はレシピ手順とレビュー文を対応付ける手法である）ため，これらの手法も対応する文の間に同じ単語や表現が出現していることを前提としている．対話を対象とした研究には，Boyerらによる対話における発話対応関係の分析がある．彼女らは，対話における隣接対(adjacencypair)構造を隠れマルコフモデル(HiddenMarkovModel;HMM)を用いてモデル化している．ただし，彼女らの分析では，隣接対の場合は多くが位置的に隣接している可能性が高いことを前提としている．これに対し，我々の研究の対象である文書対における文対応ではこういった傾向を利用できないという違いがあるため，単純に彼女らの分析手法を我々が対象としている文対応に適用することはできない．我々の研究と最も近い研究として，Qu&amp;Liuの質問応答ウェブサイトにおける文依存関係（sentencedependency;質問に対する回答，回答に対する解決報告など）を推定する研究がある．彼らは条件付確率場(ConditionalRandomFields;CRF)による分類器を利用することで，隠れマルコフモデルよりも高い性能で文依存関係を特定できたとしている．ただし，彼らの対象としているウェブサイトは図に示すように対話に近い形で問題解決を図るという特徴を持っているため，我々の対象とする文書対とは若干の違いがある．そこで，本論文では最初に彼らの手法に変形を加えることで，我々の対象である往信-返信文書間の文対応推定が実現できることを示す．次に，彼らの手法の中心である文種類推定モデルと文対応推定モデルを発展させた文種類・文対応を同時に推定する統合モデルを提案し，文対応推定が更に高い性能で実現できることを示す．</section>
  <section title="提案手法"/>
  <subsection title="文対応">文対応推定のための提案手法を説明する前に，本論文で扱う文対応について改めて定義する．本研究では，「文書（往信文書）とそれに対する返信文書が与えられた時，ある返信文がある往信文を原因として生起している関係」を文対応と定義し，この関係の有無を推定することを目的とする．なお，文対応は返信文書中の1文から，往信文書中の複数の文へ対応することを許す．また，返信文書中の異なる文から，往信文書中の同一の文への対応も許す．例えば図の「講義を楽しんでいただけて何よりです。」という返信文は，「本日の講義も楽しく拝聴させて頂きました。」という往信文を原因として書かれた文であるため，文対応を持つ．同様に，返信文「まず、課題提出日ですが…」「失礼しました。」はいずれも往信文「また、課題提出日が…」を原因として書かれた文であるため，両方の対とも文対応を持つ．なお，我々が扱う文対応関係とQu&amp;LiuZhonghua2012が扱う文依存関係(sentencedependency)とは次の点で異なる．すなわち，我々の扱う文対応は返信文から往信文へ向かう一方向のみであるが，彼らの扱う文依存関係は任意の対話文から対話文への関係を持ちうる．以降，本論文ではQu&amp;Liuが扱う対応関係を文依存関係と呼び，我々が扱う文対応関係と区別する．</subsection>
  <subsection title="文種類">次に，文対応推定に用いる素性の一つである文種類についても説明する．本研究では，「ある文がどのような目的で書かれているかによる分類」を文種類と定義する．どのような文種類の集合を用いるかは対象とする文書によって異なるが，例えば図のようなメール文書対を対象とする場合は「挨拶」「質問」「謝罪」「回答」などが文種類として考えられる．一方，質問応答ウェブサイトを対象としたQu&amp;Liuは，「質問」「回答」「挨拶」など，13種類の文種類を定義している．本研究の実験では，対象をレビュー文書とその応答文書としているため，これらの文書における文種類の分類を行っている大沢らの先行研究を元にして文種類を定義した．具体的な変更点と文種類については評価実験の章（4章）で議論する．</subsection>
  <subsection title="因子グラフと CRF">以降の節では，各CRFモデルの説明にKschischangらが提案した因子グラフ(factorgraph)を用いる．そのため，ここで因子グラフについてSutton&amp;McCallum(2012)の解説を参考にして簡単に説明する．因子グラフは，ある複数の変数に依存する関数を一部の変数のみに依存する複数の関数（因子）の積に分解した際に，どのような分解が行われているかを表現する二部グラフである．因子グラフでは，因子が依存する変数を正方形の因子ノード■からのリンクによって表す．また，変数のうち観測変数と隠れ変数を区別する必要がある場合は，観測変数を灰色（色付き）ノード，隠れ変数を白色（無色）ノードで表す．実際の因子グラフの例を図に示す．図は，観測変数x，隠れ変数yを引数に持つようなある関数F(x,y)を次のように因数分解することを示している．以降，因子グラフを数式で表現するために，因子グラフGを，変数ノードの集合V・因子ノードの集合F・エッジの集合Eの3つを用いてG=(V,F,E)のように表現する．なお，集合の表記を簡便にするため次のような記法を導入する．例えば，y_i_i=1^5のように書いた場合，これはy_i~|~1i5iN=y_1,,y_5を意味する．この記法を用いれば，図の因子グラフをG=(V,F,E)とするとV,F,Eは次のように表現できる．次に，因子グラフに基づいたCRFモデルを構築する方法について説明する．因子グラフ自体は因子が具体的にどのような関数であるかを規定しないが，関数Fを対数線形モデルによりモデル化したP(y|x)とすると，因子グラフに基づいたCRFモデルが構築できる．具体的に，因子を_a，因子_aが依存する変数をx_a,y_aと置くとP(y|x)は次のようにモデル化される．P(y|x;)&amp;=1Z_a_a(x_a,y_a;_a)&amp;=1Z_a_k_akf_ak(x_a,y_a)alignここでZは正規化項，_akは素性関数f_akに対応した重みとなる．なお，同様のモデル化を図~に行った場合がLinear-chainCRFに相当する．本論文では，各モデルはCRFによってモデル化されることとする．各モデルの因子と変数間の依存関係については，それぞれ元となる因子グラフによって示す．</subsection>
  <subsection title="文対応推定手法の概要">本論文で提案する文対応推定手法は，Qu&amp;Liuが提案した文依存関係推定手法を我々の課題に併せて変形を加えた手法と，彼らの推定モデルを発展させた新たな推定モデルによる手法の二種類である．ここで最初に，彼らの手法の概要と我々が提案する手法との相違点について説明する．Qu&amp;Liuの手法では，文依存関係を推定する問題を系列ラベリング問題と考え，Linear-chainCRF又は2DCRFを用いて推定を行う．これは，ある返信文から往信文への依存関係が存在している時，同じ返信文から隣接する往信文へも依存する可能性が高いという傾向，または逆にある往信文へ依存している返信文がある時，隣接する返信文から同じ往信文へも依存する可能性が高いという傾向を活用するためである．また，彼らは特に文依存関係分類器の素性に注目し，文の種類を素性として利用することを提案している．これは，例えば「質問」や「要求」を述べている文は通常「回答」と対応するが「挨拶」とは対応しないなど，文種類が特定できれば文依存関係の推定に有用であるという観察に基づく．ただし，このような文種類が予め分かっている状況は稀であるため，各発話の種類を推定するための分類器を別途作成する．この文種類分類器を利用する手法では，与えられた対話文書に対して事前に文種類分類器を適用して文種類を推定しておき，対話文書と文種類推定結果を文依存関係分類器に入力することで最終的に文依存関係を得る．我々の課題に合わせて彼らの手法を変形する手法では，文対応推定問題を系列ラベリング問題と考える点や文種類を利用する点で同一である．異なるのは，彼らが文種類推定器を一つしか用意せずにどの発話者による発話文に対しても同じ文種類推定器を用いていたのに対し，我々は往信文書・返信文書のそれぞれに対して別の文種類推定器を用意する点である．これは，往信文書・返信文書ではそれぞれに特有な文種類が存在するなどの異なった傾向が存在するという仮定に基づく．また，彼らが提案する文対応推定モデルは，「返信文が同じで往信文が隣接する対応」の連接性を考慮したモデルと「返信文が同じで往信文が隣接する対応」「往信文が同じで返信文が隣接する対応」双方の連接性を考慮したモデルの二種類であったが，我々は「往信文が同じで返信文が隣接する対応」のみの連接性を考慮したモデルについても検討を加える点でも異なる．また，彼らの手法と我々が新たに提案する推定モデルによる手法の違いは，彼らが文種類・文依存関係推定モデルを別々に用意して文種類推定・文依存関係推定の二段階の手順を踏むのに対し，我々は文種類・文対応推定モデルを統合した一つのモデルで一度に推定する点である．以降，節でQu&amp;Liuの推定モデルについて説明し，節以降で提案手法について順次説明する．</subsection>
  <subsection title="文種類・文依存関係推定モデルの本問題への適用">次に，以上に述べたQu&amp;Liuによる文依存関係推定モデルを，本論文の目的である二文書間の文対応推定へ適用する提案手法について説明する．本提案手法も彼らと同じく文種類推定器・文対応推定器の二種類を用意して順次推定する手法であり，以下でそれぞれについて順に説明する．ここで，説明のために以下の記号を改めて導入する．ここで，y_i,jは往信文x^o_iから返信文x^r_jの間に文対応関係が存在すれば1，しなければ0の二値を取る変数である．各文の種類を推定する問題は，文x^org（又はx^rep）を観測変数，文種類t^org（又はt^rep）を隠れ変数とした系列ラベリング問題と考えることができる．ここで，我々は往信文書・返信文書ではそれぞれに特有な文種類が存在し，それぞれの文書で文種類の連接について異なった傾向があると予想した．例えば，一般に往信文書は人に向けて文書を新たに発信する動機である「質問」や「要望」が含まれる可能性が高いのに対し，返信文書はそれに対する「回答」が含まれる可能性が高い．そこで，我々はQu&amp;Liuとは異なり，文種類分類器を往信文書用・返信文書用に別々に用意することにした．なお，いずれの分類器についてもLinear-chainCRFを利用する．以降，これらのモデルをそれぞれ往信文種類モデル・返信文種類モデルと呼ぶ．各文間の文対応を推定する問題は，二文書x^org,x^repを観測変数，文対応yを隠れ変数と考えることができる．本提案手法でも文種類分類器により推定したt^org,t^repを素性の一つに投入し，文種類を考慮した文対応の推定を実現する．以下，前節と同様にLinear-chainCRFを繰り返し適用する手法と，2DCRFを適用する手法について順次説明する．文対応の推定では，注目する文を固定すればLinear-chainCRFを繰り返し適用することで文対応y全体の推定が可能である．ここで，往信文x^o_iと返信文x^r_jのどちらを固定し，どちらの文対応連接性に注目するかで異なった分類器を作成することができる．これに対し，往信文間における対応の連接性を考慮する（返信文を固定し，y_[f],jを順次推定する）手法をL-CRF_org，返信文間における対応の連接性を考慮する（往信文を固定し，y_i,[f]を順次推定する）手法をL-CRF_repとする．それぞれの手法の推定過程を図,に示す．なお，Qu&amp;LiuがLinear-chainCRFを文依存関係推定に用いた場合が，本手法のL-CRF_orgと対応している．また，2DCRFを用いた文対応の推定も可能である．この場合，Qu&amp;Liuの場合とほぼ同様に推定が可能である．このモデルは，往信文間・返信文間それぞれにおける対応の連接性を同時に考慮できるという特徴を持っている．</subsection>
  <subsection title="文種類・文依存関係推定モデルの統合">以上までに説明した提案手法はQu&amp;Liuの手法と同様，最初に推定した文種類情報を文対応推定の素性として用いる．しかし，文種類を全て正しく推定することは困難であり，推定した文種類情報にはいくらかの誤りが含まれる可能性が高い．そのため，文種類推定時の誤りはそのまま文対応推定に影響を与える．そこで，我々は文種類と文対応を推定するモデルを統合し，両者を同時に推定することで文対応推定誤りの影響の抑制を狙った統合モデルを提案する．本論文では統合の元となるモデルとして，文種類推定にLinear-chainCRFを用いた往信文種類モデル・返信文種類モデル，文対応推定に2DCRFを用いた文対応モデルを考える．これらのモデルに対し，文種類変数と文対応変数に依存する因子関数を新たに加えることで，統合モデルを実現する．以下，具体的な統合方法について因子グラフを用いながら説明する．まず最初に，統合の元となる各モデルの因子グラフを図に示す．ここで，各モデルの因子グラフ構造を節の記法を用いて記述すると，以下の通りである．次に，以上の3モデルを統合した新たな提案モデルについて説明する．このモデルでは，文種類・文対応推定を同一のモデルで扱うために，新たに二文の文種類変数と，それと対応する文対応変数に依存する因子関数F_i,j~(1iN,~1jM)を新たに加える．これにより，往信文x^o_iと返信文x^r_jに対応する往信文種類t^o_i・返信文種類t^r_j・文対応y_i,jが非独立的に扱われるようになり，文種類・文対応を同時に推定を行うことが可能になる．提案手法全体のグラフ構造を図に示す．因子グラフ構造を具体的な式で記述すると，以下の通りである．以下，必要に応じて統合したモデルをcombineと呼ぶ．なお，Linear-chainCRFなどでは各隠れ変数の周辺確率P(y|x)をForward-Backwardアルゴリズムにより効率的に求めることができるが，統合モデルのように閉路を含む因子グラフ上のCRFには適用することができない．そのため，TreeBasedreParameterization(TRP)などにより近似的に求める必要がある．</subsection>
  <section title="評価実験"/>
  <subsection title="実験条件">実験には「楽天データ公開」に収録されている楽天トラベルのレビューを用いた．楽天トラベルのレビューでは，宿泊施設に対するユーザのレビュー文書に対して宿泊施設提供者が返答することによって文書対が構成されている．典型的な文書対と文対応を示した例を図に示す．実際には楽天トラベルのレビュー348,564件のうち，レビュー文書・応答文書の双方が存在する276,562件からランダムサンプリングした1,000文書対を用いた．この各文書を簡易的なヒューリスティックによって文単位に分割し，レビュー文4,813文・応答文6,160文を得た．この1,000文書対に対して5分割交差検定を適用して評価を行う．宿泊予約サイトの文種類の定義は，レビュー文書・応答文書ごとに文種類の分類に詳しい大沢らの先行研究を参考にした．大沢らは本実験と同じウェブサイトである楽天トラベルの「クチコミ・お客さまの声」を分析し，レビュー文を8種類，応答文を14種類に分類している．本研究では文種類が特定できれば文対応の特定が容易になるよう，レビュー文を12種類，返答文を20種類に再分類した．この分類を表及び表に示す．また，大沢らの分析からの主な変更点とその理由を以下に示す．レビュー文種類—＜ポジ／ネガ感想＞の追加：一文にポジティブ・ネガティブな感想を双方含むレビュー文は，複数の応答文と対応することがあるため．応答文種類—＜対応明示＞＜検討明示＞の具体性による細分化：具体性のある対応・検討明示文はそれぞれレビュー文で書かれた一つの事情と対応するが，抽象的なものはレビュー文で書かれた複数の事情と対応することがあるため．以上の文種類の定義に基づき，人手で文種類及び文対応の有無をタグ付けした．その結果，1,000文書対全体では4,492通りの文対応が得られた．また，文種類について，各文種類の出現数と各文種類ごとに文対応がどの程度存在するかを調査したデータを表,に示す．表中の「対応（平均数）」は一文から見たときの平均対応文数を示しており，「対応（存在率）」は一つでも対応が存在する割合を示している．表,より，例えばレビュー文種類では＜ネガティブ感想＞や＜要求・要望＞が，応答文種類では＜お詫び＞や＜具体的対応明示＞などの文種類で対応存在率が高いなど，文種類によって対応の平均数や対応存在率が大きく異なることが分かる．次に，文対応が交差する割合を示す．交差割合の計算は，各文書対において「文書対内において交差を持つ文対応の数／文書対内における全ての文対応の数」により求めた．結果，交差割合の平均は0.249であることから，本データにおいても文の出現順序と文対応の出現位置は必ずしも一致しないことが分かる．最後に，文対応の有無別にコサイン類似度の分布を表したヒストグラムを図,に示す（なお，コサイン類似度が0.3--1.0である文対応の割合は少なかったため省略している）．なお，コサイン類似度は，各文におけるstop-wordを除く単語の出現頻度を値に持つベクトルを用いて計算した値である．文対応を持つ文間の方が比較的高いコサイン類似度が高い傾向がある一方，文対応が存在する文対のうち53.56%はコサイン類似度が0であった．そのため，本データにおいても対応する文同士は必ずしも類似しないことが分かる．実験で比較する手法は次の5つである．まず，節で説明したL-CRF_org,L-CRF_rep,2DCRFの3種類を用いる．また，節で説明した統合モデルcombineを用いる．加えて，系列ラベリング問題ではなく二値分類問題と考えるモデルとしてロジスティック回帰(Logistic)でも性能を調査する．ロジスティック回帰は，L-CRFや2DCRFにおいて隣接する出力変数間の依存関係を考慮しないモデルに相当する．CRFの各モデルのパラメータ学習・利用にはMALLET2.0.7中のGRMMを用いた．GRMMに用いたパラメータはデフォルト（TRPの最大iteration回数1,000回，TRPの収束判定用の値0.01）とし，周辺確率の計算にはTRPを利用した．なお，GRMMはCRF学習パラメータの正則化にL2正則化を利用している．また，ロジスティック回帰のパラメータ学習・利用にはscikit-learn0.15.1を用い，正則化にはL2正則化を利用した．文種類の推定には，文を構成するunigram（単語の表層形）を素性として用いる．また，文対応の推定，及びcombineモデルにおいて新たに追加した因子には以下の素性を用いる．なお，単語分割にはMeCab0.994を利用した．レビュー文を構成するunigram応答文を構成するunigramレビュー文・応答文のコサイン類似度（0〜1の値）予め文種類モデルで推定したレビュー文・応答文の種類（combineモデル以外）また，unigram素性及びコサイン類似度の計算に利用する単語からは予めstop-wordを除去しており，1,000文書対全体では9,300種類の単語が存在した．文対応推定性能の評価は，適合率(Precision)・再現率(Recall)，及びそれらの調和平均であるF値から行う．すなわち，考えうる全ての文対応の可能性から正しい文対応を探す課題とみなし，次の式で計算する．Recall&amp;=正しく推定できた対応数評価データ中に存在する文対応数[0.5zw]Precision&amp;=正しく推定できた文対応数システムが文対応有りと出力した文対応数align*本実験では，以下に説明する手法により適合率・再現率を調整し，これらの性能がどのように変化するかを調査する．具体的には，文同士が対応する確率P(y_i,j=1)と対応しない確率P(y_i,j=0)の比率を取り，閾値を与えて閾値以上か否かで文対応の有無の出力を変更する．すなわち，文対応y_i,jの最終的な出力y_i,jは閾値を用いて次の式()のようにする．</subsection>
  <subsection title="実験結果と考察">実験結果を表に示す．各数値は適合率・再現率を調整した際に学習データにおいてF値が最大となる点を用い，5分割交差検定でのマイクロ平均値を計算した数値である．なお，表に示す結果のF値に対してブートストラップ検定で得られたp値をHolm法によって調整した有意水準と比較することで多重比較を行い，統合モデルcombineは他手法全てに対して統計的有意差があることを確認している（有意水準5%）-0.5zw．併せて，閾値を変化させた際のPrecision-Recall曲線を図に示す．表から，統合モデルcombineは文種類・文対応を別々に推定する各手法よりも高い性能となった．また，図より中程度の再現率(Recall:0.25〜0.75)でもcombineは概ね他手法よりも高い適合率であり，多くの場合において高い性能であったといえる．一方で，低再現率(Recall:0.0〜0.25)では，中再現率で高い適合率であったcombineよりもロジスティック回帰やL-CRF_repの方が高い性能であった．この原因を調べるため，低再現率と中再現率においてどのような文対応が推定できているかをコサイン類似度の観点から調査した．ここで，各Recall値の性能時において推定できた全ての文対応に対しコサイン類似度を計算し，平均を取った値の変化をグラフにした図を図に示す．図より，いずれの手法においても低い再現率値においてはコサイン類似度の平均が高く，徐々にコサイン類似度の平均は下がって行くことが分かる．中でもcombineは低再現率においてコサイン類似度の平均が他手法に比較すると特に低いことから，コサイン類似度の重要性を低く見ているために高類似度の文間に見られる文対応を見落としていると考えている．これに対しては，combineでは他の手法よりも単純な単語マッチなどでは推定が困難な文対応もある程度発見できるという特徴を持つことでもあるため，コサイン類似度の値によって推定手法を切り替えるなどで様々な文対にも対応可能になると考えている．すなわち，コサイン類似度が高い文対ではロジスティック回帰やL-CRF_repなど，低い文対ではcombineを用いることで，より推定性能が向上すると考えている．次に，combineモデルにおける文種類ごとの推定性能を表,に示す．いずれの文書を基準にしても文種類によって性能に大きな差があるが，この主な理由は学習データ量の差によるものと考えている．すなわち，一部の文種類はほとんど文対応を持たないことや，そもそも当該文種類を持つ文の出現回数が少ないことに起因して学習が難しくなっている．特に前者については，例えばレビュー文種類＜感謝・応援＞＜プラン名＞や応答文種類＜投稿御礼＞について表,を見ると，登場する回数は多いものの文対応を持つものは極めて少ないことが分かる．これらの文種類については再現率が高いものの適合率が極めて低いことから，過剰に対応有りと推定してしまっていることが分かる．このように対応する可能性が低い文種類については，推定後に予め人手で作成したルールによりフィルタリングするなどにより解決できると考えている．次に，実際のcombineモデルの出力例を図に示す（表に示すF値最大点における出力結果）．図中の実線が推定によって得られた正しい文対応を示し，実線に記号があるものは対応有りと推定されたが実際には対応していないもの，破線は対応無しと推定されたが実際には対応しているものを示す．図左側は誤りなく文対応を推定できた例である．例えばレビュー文「フロントの係の方や…」「駅から歩いて5分程…」はいずれも対応先の応答文「また、温かな嬉しいお言葉…」と共通する内容語が存在しないが，正しく文対応が推定できている．これは，それぞれの文種類を＜ポジティブ感想＞＜ほめへの感謝＞と正しく推定できており，加えて「気持ちよく」「おいしい」「便利」といった語が現れる文と「御礼」といった言葉が現れる文の間には対応する可能性が高いといった傾向をうまく学習できたことによると考えている．また，図右側は誤った推定が含まれている例である．例えばレビュー文「夜遅かったので…」は応答文「また、フロントスタッフに対しても…」と対応していると推定して誤っている．これは逆に，文種類がそれぞれ＜ポジティブ感想＞＜ほめへの感謝＞であることや，レビュー文中に「チェックアウト」が，応答文中に「フロント」「スタッフ」などの語が出現すると対応しやすいという傾向に影響されているためであると考えている．この場合，それぞれの文で触れられている対象が，チェックアウト時刻そのものなのか，チェックアウト時のスタッフの対応なのかを区別できればより正確な推定が可能になる．同様に，「夜遅かったので…」に対して応答文「当ホテルでは…」「クリスマスシーズン…」の間の文対応を発見することができなかった問題についても，それぞれの文でチェックアウト時刻に触れられていることを特定できれば対応を発見できる可能性が向上すると考えている．最後に，combineモデルと2DCRFモデルによる出力の比較例を図に示す（表に示すF値最大点における出力結果）．この例では，2DCRFモデルでは誤って対応ありと出力したペアに対しても，combineモデルでは正しく対応がないと出力できている．2DCRFモデルが誤った理由の一つとして，文対応推定の前提処理である文種類推定の誤りによる影響があると考えている．この例では，応答文「今回はサラダのある…」及び「次回宿泊時には…」に対して文種類＜情報追加＞が誤って推定されているが（正しくは＜お詫び＞及び＜対話＞），報追加＞は関連した語が登場するレビュー文と対応を持ちやすいという傾向があるため，過剰に対応有りと出力されていると考えている．これに対し，combineモデルでは文種類と文対応を同時に推定するため，事前の文種類推定における誤りに影響されるといったことはないため正しく推定できている．</subsection>
  <section title="まとめと今後の課題">本論文では，対応する二文書間において文対応を自動で推定するタスクを提案した．また，対話文書を対象とした従来手法を本タスクに適用すると共に，文種類と文対応を推定するモデルを統合した新しいモデルを提案した．実際に文対応の推定性能について比較実験を行い，中再現率において統合モデルは他モデルよりも高い適合率であること，特にF値最大点では最も高いF値であることを確認した．今後の課題として，以下の項目を考えている．本論文の実験では，文対応推定に利用した素性は適用する文書対の分野に依存しないものに限られていた．そのため，文書対によっては分野に合わせた素性を投入することで性能が向上する可能性がある．特に，宿泊予約サイトのレビュー・応答文書対に合わせた素性を検討することを考えている．また，本研究では二文書の対に限っていたが，メールや掲示板等では「返信の返信」のように三文書以上が関係する場合もある．ここで，往信文書を文書A，文書Aに対する返信文書を文書B，文書Bに対する再返信文書を文書Cとした場合，文書Bでは文書Aに対する返信文に加え，文書Cへの往信文が登場するという性質を持つ．例えば，文書Bにおける回答は文書Aと対応し，文書Bにおける質問は文書Cと対応する．また，文書Bにおける回答文に対して文書Cでフィードバックが行われている場合など，文書Bのある一文が文書A,C双方と関係を持つ場合もある．この場合，文書A-文書B及び文書B-文書Cのそれぞれで本研究での提案手法を繰り返し適用する素朴な方法も考えられる．この際，文書Bの文種類をそれぞれの推定手順で返信文種類集合，往信文種類集合に切り替えて別々に推定するという方法もあるが，新たに往信文書・返信文書のいずれでもあるような文書のための文種類を新たに定義するという方法もある．更に，繰り返し推定するのではなく，文書A,B,Cの文種類・文対応を同時に推定するモデルに拡張するという方法も考えられる．加えて，本研究で扱う文対応の定義からは外れるものの，文書Bを経由せずに文書Aと文書Cで関連しているといった，三文書以上が関わることで初めて観察される関係もある．例えば，文書Aでした質問のいくつかが文書Bで答えられなかった場合に，文書Cで再度質問に触れる場合などがある．今後，三文書以上になることで新たに発生する事象についてはこのような関係も含めて分析を行い，三文書以上における文対応推定に最適な手法を検討したいと考えている．加えて，本論文の冒頭で紹介したような応用についても取り掛かりたいと考えている．今回対象となったデータセットであるレビュー文書・応答文書対についても様々な応用が考えられるため，応答文書の書き手の支援にとどまらず，ウェブサイトの利用者全体にとって有用なアプリケーションも実現したいと考えている．</section>
</root>
