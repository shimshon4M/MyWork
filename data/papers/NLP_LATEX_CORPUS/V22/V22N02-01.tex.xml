<?xml version="1.0" ?>
<root>
  <jtitle>医療用語資源の語彙拡張と診療情報抽出への応用</jtitle>
  <jauthor>東山翔平関和広上原邦昭</jauthor>
  <jabstract>近年，医療文書の電子化が進み，大規模化する医療データから有用な情報を抽出・活用する技術が重要となっている．特に，診療記録中の症状名や診断名などの用語を自動抽出する技術は，症例検索などを実現する上で必要不可欠である．機械学習に基づく用語抽出では，辞書などの語彙資源の利用が訓練データに含まれない用語の認識に有効である．しかし，診療記録では多様な構成語彙の組合せからなる複合語が使用されるため，単純なマッチングに基づく辞書の利用では検出できない用語が存在し，語彙資源利用の効果は限定的となる．そこで，本稿では，語彙資源を有効活用した用語抽出を提案する．資源活用の1点目として，資源中の用語に対して語彙制限を行うことで，用語抽出に真に有用な語彙の獲得を行う．2点目として，資源から複合語の構成語彙である修飾語を獲得し，元の語彙に加えて獲得した修飾語を活用することで，テキスト中のより多くの用語を検出する拡張マッチングを行う．検出された用語の情報は機械学習の素性として用いる．NTCIR-10MedNLPテストコレクションを用いた抽出実験の結果，単純な語彙資源の利用時と比較して適合率および再現率の向上を実現し，本手法の有効性を確認した．また，肯定・否定などのモダリティ属性の分類を含めた抽出では，従来手法に対して，本手法が最も高い精度を実現した．</jabstract>
  <jkeywords>医療言語処理，用語抽出，NTCIR-10MedNLPタスク</jkeywords>
  <subsubsection title="">*MedNLPテストコレクションMedNLPテストコレクションは，医師により書かれた架空の患者の病歴要約50文書からなるデータセットであり，2対1の比率で訓練データとテストデータに分割されている．同テストコレクションには，患者の個人情報および診療情報がアノテーションされている．個人情報は患者の名前，年齢，性別と，日時，地名，医療機関名からなり，診療情報は患者の症状や医師の診断（症状・診断名）を指す．このうち，症状と診断タスクで対象とされたのは後者の診療情報である．症状・診断名には，医師の認識の程度などを表すモダリティ属性が定義されており，それぞれ症状の罹患の肯定，否定，推量（可能性の存在）を表すpositive，negation，suspicionに加え，症状が患者の家族の病歴として記述されていることを表すfamilyの4種類からなる．以下，&lt;n&gt;&lt;/n&gt;，&lt;s&gt;&lt;/s&gt;，&lt;f&gt;&lt;/f&gt;で囲まれた範囲をそれぞれモダリティ属性がnegation，suspicion，familyである症状・診断名であるとして，各モダリティ属性が付与された症状・診断名の例を示す．「&lt;n&gt;糖尿病&lt;/n&gt;は認めず」「&lt;n&gt;関節症状&lt;/n&gt;は改善した」「&lt;s&gt;神経疾患&lt;/s&gt;の疑いにて」「&lt;s&gt;味覚異常&lt;/s&gt;の可能性を考え」「&lt;n&gt;胆嚢炎&lt;/n&gt;を疑わせる所見を認めず」「母親；&lt;f&gt;気管支喘息&lt;/f&gt;」「父：&lt;f&gt;狭心症&lt;/f&gt;、&lt;f&gt;心筋梗塞&lt;/f&gt;」「娘３人は鼻粘膜の&lt;f&gt;易出血性&lt;/f&gt;があり」negation，suspicion属性については，(a)〜(d)に示すように，症状・診断名の係り先の文節が特定の表現を含む場合に，その表現に対応するモダリティ属性となることが多い．ただし，(e)のように，直接の係り先がsuspicionを示す表現を含んでいても，後方に否定表現が現れることによりnegationとなることがある．family属性の症状・診断名は，(f)，(g)のように，続柄名の後に症状・診断名を列挙する形で記述された場合が該当する他，(h)のように，文全体の主語が続柄である場合も該当する．なお，positive属性は，negation，suspicionおよびfamilyであることを示す表現と共起しない症状・診断名に対して付与される属性とみなせる．表に，訓練データにおける各モダリティ属性の出現回数（``#''の列）を示す．出現回数はモダリティ属性の種類により偏りがあり，positiveが7割程度を占めているのに対し，suspicion，familyは非常に少数となっている．</subsubsection>
  <section title="はじめに">近年，電子カルテに代表されるように，医療文書が電子的に保存されることが増加し，構造化されていないテキスト形式の医療情報が増大している．大規模な医療データには有用な情報が含まれ，新たな医学的知識の発見や，類似症例の検索など，医療従事者の意思決定や診療行為を支援するアプリケーションの実現が期待されている．これらの実現のためには，大量のテキストを自動的に解析する自然言語処理技術の活用が欠かせない．特に，テキスト中の重要な語句や表現を自動的に認識する技術は，固有表現抽出や用語抽出と呼ばれ，情報検索や質問応答，自動要約など，自然言語処理の様々なタスクに応用する上で必要不可欠な基盤技術である．用語抽出を実現する方法として，人手で作成した抽出ルールを用いる方法と，機械学習を用いる方法がある．前者の方法では，新しく出現した用語に対応するために随時ルールの修正や追加を行わなければならず，多大な人的コストがかかる．そのため，近年では，データの性質を自動的に学習することが可能な機械学習が用いられることが多くなっている．機械学習に基づく用語抽出では，抽出すべき語句の情報がアノテーションされた訓練データを用いてモデルの学習を行い，学習したモデルを未知のデータに適用することで，新しいデータから用語の抽出を行う．高精度な抽出を可能とするモデルを学習するには，十分な量の訓練データがあることが望ましい．しかし，診療記録などの医療文書は，医師や患者の個人情報を含むため，医療機関の外部の人間が入手することは困難である．幸い，近年は，研究コミュニティでのデータ共有などを目的とした評価型ワークショップが開催されており，匿名化などの処理が施された医療文書データが提供され，小規模なデータは入手可能になっている．とはいえ，依然として，学習に利用できる訓練データの量は限られることが多い．他方，一般に公開されている医療用語辞書などの語彙資源は豊富にあり，英語の語彙資源では，生物医学や衛生分野の用語集，シソーラスなどを含むUMLS(UnifiedMedicalLanguageSystem)，日本語の語彙資源では，広範な生命科学分野の領域の専門用語などからなるライフサイエンス辞書，病名，臨床検査，看護用語などカテゴリごとの専門用語集を含むMEDIS標準マスターなどが提供されている．辞書などの語彙資源を利用した素性（辞書素性）は，訓練データに少数回しか出現しない用語や，まったく出現しない未知の用語を認識する際の手がかりとして有用であるため，訓練データの量が少ない場合でも，こうした語彙資源を有効活用することで高精度な抽出を実現できる可能性がある．しかし，既存の医療用語抽出研究に見られる辞書素性は，テキスト中の語句に対して辞書中の用語と単純にマッチングを行うものに留まっている．診療記録では多様な構成語彙の組合せからなる複合語が使用されるため，単純な検索ではマッチしない用語が存在し，辞書利用の効果は限定的であるといえる．本研究では，類似症例検索などを実現する上で重要となる症状名や診断名（症状・診断名）を対象とした用語抽出を行う．その際，語彙資源から症状・診断名の構成要素となる語彙を獲得し，元のコーパスに併せて獲得した語彙を用いることで，より多くの用語にマッチした辞書素性を生成する．そして，生成した辞書素性を機械学習に組み込むことで，語彙資源を有効活用した抽出手法を実現する．また，提案手法の有効性を検証するために，病歴要約からなるNTCIR-10MedNLPタスクのテストコレクションを用いて評価実験を行う．本稿の構成は以下の通りである．まず，章で医療用語を対象とした用語抽出の関連研究について述べ，章で本研究のベースとなる機械学習アルゴリズムlinear-chainCRFに基づくシステムを説明する．章では，語彙資源から症状・診断名の構成語彙を獲得する方法と，獲得した語彙を活用した症状・診断名抽出手法を説明する．章でMedNLPテストコレクションを用いた評価実験について述べ，最後に，章で本稿のまとめを述べる．</section>
  <section title="関連研究">テキスト中の特定の語句や表現を抽出する処理を固有表現抽出や用語抽出という．固有表現は，主に人名・地名・組織名などの固有名詞や時間・年齢などの数値表現を指し，固有表現抽出では，これらの固有表現を抽出の対象とすることが多い．一方，用語抽出では特定の分野の専門用語などを対象とする．しかし，対象とする語句を抽出するというタスク自体に違いはないため，本稿では，特に両者を区別せず，抽出対象として指定される語句を固有表現と呼ぶ．</section>
  <subsection title="医療用語抽出研究">日本語の医療文書を対象に医療用語の抽出や探索を行った研究として，がある．井上らは，文章の記述形式に定型性のある医療論文抄録を対象に，パターンマッチングに基づく方法を用いて，病名（「論文が取り扱っている主病名」）や診療対象症例（「診断，治療の対象とした患者，症例」）などの事実情報を抽出した．たとえば，病名は「〜症」「〜炎」「〜腫」などの接尾辞の字種的特徴を手がかりに用い，診療対象症例に対しては，「対象は〜」「〜を対象とし」のような対象症例と共起しやすい文字列を手がかりに用いて抽出している．なお，井上らの報告によると，論文抄録中に含まれる病名や診療対象症例の出現回数は平均1回強である．アノテーションを行った医療論文抄録を用いた抽出実験では，病名や診療対象症例に関して，90%前後の適合率，80%から100%近い再現率という高い精度を得ている．しかし，本稿で対象とする病歴要約では論文抄録と出現の傾向が異なり，同一文書中に様々な病名が出現することが多いため，井上らのパターンマッチングに基づく手法では抽出精度に限界があると考えられる．木浪らは，専門用語による研究情報検索への応用を目的として，再現率の向上を優先した看護学用語の抽出手法を提案した．抽出対象とされた専門用語は，解剖学用語（「血小板」，「破骨細胞」など）や看護行為（「止血」，「酸素吸入」など）を含み，本稿で対象とする症状・診断名よりも広い領域の用語である．特定の品詞を持つ語が連続した場合にそれらの語を連接して抽出するなど，連接ルールに基づくシステムにより専門用語を抽出した．システムによる抽出を行うフェーズと，抽出されなかった用語や誤って抽出された用語を人手で分析してルールの修正・追加を行うフェーズを繰り返し，再現率が向上し，再現率が低下しない範囲で適合率が向上するようなルール集合を導出している．実験では，専門家によるアノテーションを行った看護学文献を用いて評価し，再現率約80%という抽出結果を得ている．この手法では，適用する専門用語の領域が異なる場合，再び導出手順を踏んでルールを導出し直す必要がある．しかし，抽出ルール修正の過程が人手による判断に依存しており，再度ルールを導出する際の人的コストが大きい．また，適合率が約40%と低く，適合率を改善するにはルール導出の基準自体も修正する必要が生じる．上杉は，医療用語抽出の前処理として，医療辞書なしで医療コーパス中の用語間の分割位置を探索する研究を行った．文字列X，Yの出現確率に対し，XYが同時に出現する確率が十分に低ければX，Y間を分割できるとの考えに基づき，コーパスから求めた文字列の出現確率と相互情報量を使用して分割位置を決定している．症例報告論文を用いた実験では，約740語に対して60%の分割精度であり，分割に成功した事例の中には，複合語が1語と認識される場合と複合語の内部でさらに分割される場合がほぼ同等の割合で存在した．残りの40%には，助詞が付加される，英字やカタカナ列の途中で分割されるなどの誤りがあるため，自然言語文に対する分割精度として十分であるとはいえない．なお，医療用語抽出に応用するには，分割された各単語が医療用語か否かを判定する基準が別途必要となる．</subsection>
  <subsection title="医療言語処理ワークショップとNTCIR-10 MedNLP">近年，医療文書を対象とした共通タスクを設定し，研究コミュニティでのデータ共有や，データ処理技術の向上を目的とする参加型ワークショップが開催されている．英語の医療文書を処理の対象としたタスクとしては，2011年および2012年にNISTが主催するTRECにおいてMedicalRecordstrackが設定され，2006年および2008年から2012年に渡ってi2b2NLPチャレンジが開催された．i2b2NLPチャレンジでは，診療記録からの情報抽出技術の評価を目的とした共通タスクが実施され，匿名化のための個人情報，患者の喫煙状態，医薬品の使用状況や医療上のコンセプトの抽出が行われた．また，日本語の医療文書を使用したタスクとして，2013年にはNIIが主催するNTCIRにおいてMedNLPタスクが設定され，患者の個人情報や診療情報を対象に情報抽出技術の評価が行われた．NTCIR-10MedNLPタスクでは，医師により書かれた架空の患者の病歴要約からなる日本語のデータセット（MedNLPテストコレクション）が使用された．データから患者の年齢，日時などの個人情報を抽出する「匿名化タスク」と，患者の症状や医師の診断などの診療情報（症状・診断名）を抽出する「症状と診断タスク」などが設定された．症状・診断名には，症状の罹患の肯定，否定などを表すモダリティ属性が定義されており，モダリティ属性の分類もタスクの一部となっている．なお，両方のタスクとも，それぞれ個人情報，診療情報を固有表現とした固有表現抽出とみなせる．タスク参加者のシステムは，ルールに基づく手法よりも機械学習に基づく手法が多く，特に，学習アルゴリズムとしてCRF(ConditionalRandomFields)の代表的なモデルであるlinear-chainCRFを用いたシステムが高い性能を発揮した．また，成績上位のシステムでは，文中の各単語が辞書中の語とマッチしたか否を表す情報（辞書素性）が共通して用いられており，語彙資源の利用が精度向上に寄与したことがわかる．一方，匿名化タスクではルールに基づく手法も有効であり，最高性能を達成したのはルールベースのシステムであった．Miuraらは，固有表現抽出タスクを文字単位の系列ラベリングとして定式化してlinear-chainCRFを適用し，症状と診断タスクで最も高い精度を達成した．固有表現の抽出を行った後，抽出した固有表現のモダリティ属性を決定するという2段階の方法を使用している．MEDIS標準マスターおよびICH国際医薬用語集を語彙資源に用いて辞書素性を与えている．Laquerreら，Imaichiらは，ともに単語単位の系列ラベリングとしてlinear-chainCRFを適用し，症状と診断タスクでそれぞれ2番目，3番目の精度を達成している．Laquerreらは，ライフサイエンス辞書とUMLSMetathesaurusを利用し，辞書素性を導入している．また，事前知識に基づくヒューリスティック素性として，「ない」「疑い」などモダリティ属性判別の手がかりとなる表現を素性としている．Imaichiらは，Wikipediaから収集した病名，器官名などの用語集に基づく辞書素性を導入している．</subsection>
  <section title="Linear-chain CRFに基づく症状・診断名抽出システム">本章では，症状・診断名の抽出のためにベースとするシステムを説明する．本研究では，用語抽出の処理を症状・診断名からなる固有表現を抽出するタスクとみなし，系列ラベリングとして定式化する．また，固有表現の抽出は，機械学習アルゴリズムlinear-chainCRFを用いて行う（以降，本研究で用いたlinear-chainCRFを指す場合，単にCRFと呼ぶ）．さらに，CRFで抽出を行った出力に，人手で作成したルールを用いて抽出誤り訂正の後処理を行うことで，より誤りの少ない抽出を実現する．</section>
  <subsection title="MedNLP「症状と診断タスク」の定義">NTCIR-10MedNLP(MedicalNaturalLanguageProcessing)タスクは，医療分野における情報抽出技術の評価を目的として実施されたタスクである．診療記録から症状・診断名を抽出する「症状と診断タスク」を含む3つのサブタスクが定義された．本研究では，MedNLPタスクで使用されたデータセット（MedNLPテストコレクション）を使用し，症状と診断タスクと同様の設定で症状・診断名の抽出を行う．以下，MedNLPテストコレクションおよび症状と診断タスクについてそれぞれ説明する．</subsection>
  <subsection title="固有表現抽出タスクの定式化">本研究では，各モダリティ属性が付与された症状・診断名を異なるカテゴリの固有表現とみなして固有表現抽出を行うことで，症状・診断名の抽出範囲およびモダリティ属性の決定を行う．固有表現抽出は，入力文中の固有表現部分を同定するタスクであり，系列ラベリングとして定式化されることが多い．系列ラベリングとは，入力系列に対してラベルの系列を出力する問題である．固有表現抽出では，トークンの系列である文を入力として，トークンごとに固有表現の種類等を表すラベルを推定し，それらラベルの列を出力する．本研究では，形態素をトークンとする系列ラベリングとして固有表現抽出の定式化を行う．定式化の際には，同一の固有表現（チャンク）中の位置を表すためのチャンキング方式として，IOB2フォーマットを使用した．IOB2では，タグはB(Begin)，I(Inside)，O(Outside)の3種類があり，それぞれチャンクの先頭，チャンクの先頭を除く内部，チャンクの外側を表す．なお，複数のカテゴリの固有表現が存在する場合，B，Iはカテゴリ名と併せて使用される．たとえば，「嘔吐／B-c_pos~~出現／I-c_pos~~した／O」のようにラベルを付与することで，「嘔吐出現」がc_pos（肯定のモダリティ属性を持つ症状・診断名）というカテゴリの固有表現であることを表す．なお，入力文の形態素解析には，linear-chainCRFに基づく日本語形態素解析器であるMeCab(Ver.~0.996)およびIPADIC(Ver.~2.7.0)を用いた．</subsection>
  <subsection title="CRFによる分類">本システムでは，機械学習アルゴリズムとしてlinear-chainCRFを用いた．linear-chainCRFは，分類アルゴリズムである最大エントロピー法を出力が構造を有する問題（構造学習）に拡張したモデルである．品詞タギング，基本名詞句同定，形態素解析など，構造学習，特に，系列ラベリングとして定式化できる自然言語処理の様々な問題に適用され，高い性能が報告されている．また，固有表現抽出の研究においても広く使用され，NTCIR-10MedNLPタスクでも最もよく用いられた．linear-chainCRFの実装としては，C++で記述されたオープンソースソフトウェアであるCRF++(Ver.~0.58)を利用した．CRF++は，準ニュートン法の一種であるL-BFGS(Limited-memoryBFGS)を使用して数値最適化を行っており，省メモリで高速な学習を実現している．また，素性テンプレートという素性の記述形式が定義されており，テンプレートを利用することで多様な素性を容易に学習に組み込むことができるという特長がある．CRF++の素性テンプレートでは，出力ラベル系列についてのunigram素性およびbigram素性が利用可能である．出力ラベルunigram素性は，入力系列についての任意の情報（系列中の特定のトークンの形態素自体や品詞など）と現在のトークンのラベルの組からなる素性を指し，出力ラベルbigram素性は，入力系列の任意の情報，現在のトークンのラベルおよび1つ前のトークンのラベルの三つ組からなる素性を指す．本研究では，すべての素性に対して出力ラベルunigram素性およびbigram素性の両方を使用することとした．たとえば，品詞素性を-2から2までのウィンドウで用いると述べた場合，注目するトークンの2つ前方から2つ後方に位置するトークンの品詞について，それぞれで出力ラベルunigram素性およびbigram素性を使用することを意味する．なお，指定した値未満の出現回数である素性を学習に使用しないことを意味する素性のカットオフの閾値は1とし，訓練データに出現したすべての素性を使用することにした．また，正則化にはL2正則化を用いた．</subsection>
  <subsection title="抽出に用いる素性">本システムでは，症状・診断名抽出のための素性として，「形態素」，「形態素基本形」，「品詞」，「品詞細分類」，「字種」，「辞書マッチング情報」，「モダリティ表現」の7種類の情報を用いた．注目するトークンを起点にどこまでの範囲のトークンの情報を素性に用いるかを表すウィンドウサイズについては，モダリティ素性を除き，章で述べる実験により最適な値を決定する．モダリティ素性のウィンドウサイズについては後述する．</subsection>
  <subsection title="抽出誤り訂正のための後処理ルール">著者らは，NTCIR-10MedNLPタスクに参加し，構造化パーセプトロンおよびlinear-chainCRFに基づく固有表現抽出システムを開発してきた．開発したシステムについてエラー分析を行ったところ，観測された誤りの中で，モダリティ属性の分類誤りが大きな割合を占めることがわかった．この種の誤りは単純なルールで修正できるため，モダリティ属性の分類誤りに焦点を当て，誤り訂正のためのルールを作成することにした．観測されたモダリティ属性分類誤りは，さらに次の2通りに大別できたため，それぞれの誤りに対応する訂正ルールとして，2つのルールを作成した．固有表現の周辺に（非positive属性の）モダリティ表現が存在し，かつ推定された属性が同表現が表す属性と異なっている（主にpositiveとなっている）誤り固有表現の周辺にモダリティ表現が存在せず，かつ推定された属性がpositive以外となっている誤り作成した2つのルールを以下に示す．``［］''の外側（左側）にnegationおよびsuspicion属性に対する条件，``［］''の内側にfamily属性に対する条件を記述した．正しい推定に対して修正ルールを適用してしまうことを防ぐため，後述するd_1およびd_2の値は，d_1=2，d_2=8として，ルールの適用基準を厳しく設定した．ただし，family属性のモダリティ表現が出現する文中の症状・診断名が患者の家族に対する言及でないというケースは極めて少ないとの考えの下，familyに対する距離はd_1=d_2=，つまり，該当位置から到達可能な同一文内の最大トークン数とした．</subsection>
  <section title="医療用語資源の語彙拡張と症状・診断名抽出への利用">用語抽出への語彙資源の利用は，訓練データに少数回しか出現しない用語やまったく出現しない用語の認識に有効であり，医療用語辞書などの語彙資源を用いた医療用語抽出研究が行われている．しかし，診療記録では症状・診断名として多様な複合語が使用されるため，テキスト中の語句に対して辞書中の用語と単純にマッチングを行うだけではマッチしない複合語が存在し，辞書利用の効果は限定的となる．そこで，本章では，語彙資源中の複合語から構成語彙を獲得する方法と，構成語彙を組み合わせてより多くの複合語にマッチする拡張マッチングの方法を述べ，これらの方法に基づく語彙資源を活用した症状・診断名の抽出手法を提案する．</section>
  <subsection title="基本的な考え：医療用語の構成語彙への分解">症状・診断名は，複数の医療用語から構成される複合語であることが多い．たとえば，「水痘肺炎」という用語は「水痘」と「肺炎」から構成され，「甲状腺出血」は「甲状腺」と「出血」から構成される．診療記録では，多様な構成語彙を組み合わせた複合語が用いられる一方で，実際に用いられる複合語の中には辞書中には含まれないものも多い．例として，「水痘感染」と「甲状腺腫大」は，診療記録コーパスMedNLPテストコレクション中で用いられ，医療用語辞書MEDIS病名マスター中に存在しなかった症状・診断名である．ただし，上述の用語の各構成語彙に注目すると，「水痘」，「感染」，「甲状腺」，「腫大」を構成語彙として含む用語は同辞書中に多数存在した（表）．したがって，症状・診断名の抽出に，既存の辞書中に含まれる用語をそのまま用いて対応するには限界があるといえる．また，症状・診断名としてありうる構成語彙の組合せは膨大な数に上ると考えられ，それらを網羅的に含むような辞書を構築することも現実的ではない．一方で，症状・診断名の構成語彙となる語の多くは，辞書中の用語の部分文字列として辞書に含まれている可能性が高い．そこで，本研究では，既存の医療用語資源から症状・診断名の構成語彙となる語句を獲得し，得られた構成語彙を組み合わせた柔軟なマッチング方法「拡張マッチング」に基づく症状・診断名の抽出手法を提案する．なお，マッチした結果は，機械学習の素性（辞書素性）として用いる．語彙資源を活用した拡張マッチングによって，辞書素性タグが付与される語句が増加し，元の辞書に含まれない語彙にも対応した抽出が可能になると考えられる．</subsection>
  <subsection title="主要語辞書と修飾語辞書に基づく拡張マッチング">症状・診断名の構成語彙の獲得にあたり，構成語彙には，単独で症状・診断名として用いられる「主要語」と，主要語と隣接して現れたときにのみ症状・診断名の一部となる「修飾語」の2種類が存在すると仮定する．節で述べた例では，「水痘」，「感染」，「腫大」が主要語に相当し，「甲状腺」が修飾語となる．「水痘感染」や「甲状腺腫大」のように，構成語彙に分解される前の元の用語自体も主要語とみなす．主要語と修飾語の具体的な獲得方法は次節以降で後述することにし，本節では，主要語辞書と修飾語辞書の2種類の辞書を用いた症状・診断名のマッチング方法「拡張マッチング」を説明する．以下，「消化管悪性腫瘍の」という入力文が与えられた場合を例に，拡張マッチングの手順を述べる．主要語辞書には「消化管障害」，「腫瘍」，「悪性腫瘍」が含まれ，修飾語辞書には「消化管」，「悪性」が含まれているものとする．</subsection>
  <subsection title="主要語辞書の利用と語彙制限">本研究では，主要語辞書として，MEDIS病名マスター(Ver.~3.11)と，MedNLPテストコレクションの訓練データを利用する．MEDIS病名マスター（ICD10対応標準病名マスター）は，一般財団法人医療情報システム開発センターにより提供されている病名辞書である．病態毎に選ばれた代表病名を表す「病名表記」に加え，病名表記の読み，ICD10コードなどから構成され，本研究で利用したVer.~3.11では，24,292語が収載されている．同辞書に含まれる病名表記を抽出し，主要語辞書として用いる．MedNLPテストコレクションは，NTCIR-10MedNLPタスクで提供された模擬患者の病歴要約からなるコーパスである．同コーパスの訓練データからアノテーションされた症状・診断名部分を抽出し，主要語辞書MedNE（延べ語数1,922，異なり語数1,068）として用いる．ただし，主要語辞書をそのまま用いると，一部の語が用語抽出の学習に悪影響を与える場合がある．たとえば，細菌性皮膚感染症の一種である「よう」（癰）は，「〜するようになった」などの表現にマッチしてしまう．また，「喫煙歴」という表現に含まれる「喫煙」は，必ずしも患者の喫煙を表す言及ではないため症状・診断名に該当しない．このように，症状・診断名と無関係の表現とマッチする用語や，高頻度で非症状・診断名としても使用される用語を辞書が含んでいる場合，学習を阻害する要因となる．そこで，MedNLP訓練データを使用し，高い割合で症状・診断名とマッチする用語を取得する処理を行う．以下，各主要語辞書に対する語彙制限の方法を述べる．なお，後述の閾値n_out，r_out，n_inおよびr_inは，章で述べる実験により決定する．</subsection>
  <subsection title="医療用語資源からの修飾語の獲得">節で述べたように，主要語に含まれる部分文字列の中には有用な修飾語が多く含まれるという考えに基づき，主要語から部分文字列を切り出すことで修飾語を獲得する．修飾語の獲得には，主要語の取得と同様にMEDIS病名マスターとMedNEを用いる．なお，MEDIS病名マスターの関連リソースとして提供されている「修飾語テーブル」は，本研究では使用しない．修飾語は，主要語辞書でマッチした範囲を拡張する際にのみ用いるため，意味をなさない非語が含まれていても，実際にテキスト中で主要語と隣接して現れなければ学習・抽出に影響を与えない．ただし，MEDIS病名マスターには動詞や助詞，記号などを含む用語（「１型糖尿病・関節合併症あり」，「アヘン類使用による急性精神・行動障害」など）が存在するため，切り出された部分文字列が助詞などの表現を含んでいると，症状・診断名でない範囲にまで拡張してしまう可能性がある．そこで，部分文字列を切り出すことにより機械的に修飾語候補を抽出した後，意味をなさないと考えられる候補と，過大な拡張を行う可能性のある有害な候補を除去するという手順により修飾語の獲得を行う．なお，有害な候補の除去には，主にひらがなから構成される語40語程度の「ひらがな表現」リストを作成し，使用した．同リストは，助詞（「が」や「より」），接続詞（「または」や「かつ」），動詞・助動詞の組合せ（「ならない」）などひらがなのみから構成される表現の他，一部，「著しい」など漢字を構成要素に持つ表現も含む．「ひらがな表現」の全リストは付録に記載する．</subsection>
  <section title="評価実験">本研究で開発した用語抽出システムの性能を評価するため，MedNLPテストコレクションを用いて評価を行った．次節以降で，基本素性（形態素，品詞，品詞細分類，字種，基本形）の評価，モダリティ素性の評価，主要語語彙制限および拡張マッチングの有効性の評価を行う．さらに，すべての素性に加えて後処理ルールを適用した提案システム全体の性能を評価し，MedNLPタスクの参加システムである従来手法との比較を行う．</section>
  <subsection title="実験設定">実験に使用したMedNLPテストコレクションは，病歴要約50文書からなり，全データの3分の2にあたる2,244文が訓練データ，残りの1,121文が評価用のテストデータとなっている．訓練データにアノテーションされた情報は，患者の個人情報と診療情報である．本研究では，これらのうち，患者の症状と医師の診断を指す診療情報（症状・診断名）を対象とする．各症状・診断名には医師の認識の程度などを表すモダリティ属性が定義されており，それぞれ症状の罹患の肯定，否定，可能性の存在を表すpositive，negation，suspicionに加え，症状が患者の家族の病歴として記述されていることを表すfamilyの4種類からなる．各モダリティ属性が付与された症状・診断名を異なるカテゴリの固有表現とみなして学習を行うことで，モダリティ属性の分類を含めた抽出を行う．評価は，MedNLPタスクで行われたのと同様に，モダリティ属性を考慮する方法と，考慮しない方法の2通りで行う．前者は，抽出された固有表現が正しい属性に分類された場合にのみ正解とみなす評価であり，後者は，属性が誤っていても，抽出された固有表現の範囲がアノテーションされた正解情報と一致していれば正解とみなす評価である．それぞれの評価方法について，適合率，再現率，F値を評価尺度として用いる．CRFで学習を行う際に必要となる正則化のためのハイパーパラメータcについては，訓練データでの5分割交差検定により値を決定した．テストデータに対する抽出を行うまでの具体的な手順は以下の通りである．cの値を変化させながら，各cの値について訓練データで5分割交差検定を行い，5回の検定における各精度（適合率，再現率，F値）の平均をそれぞれ算出する．cの値の中で，最もF値が高い結果となったものを最適値とする．得られたcの最適値を用いて，訓練データ全体で学習を行い，モデルを学習する．続いて，学習で得られたモデルを用いてテストデータで抽出を行う．なお，主要語の語彙制限および修飾語獲得の際の閾値については，次のように決定した．MEDIS病名マスターの語彙制限では，n_out3,5,8，r_out0.5,0.7,0.9の各組について，ハイパーパラメータcの値を変えながら，それぞれ訓練データで交差検定を行い，最もF値が高かったn_out，r_out，cの値の組合せを最適値としてテストデータでの評価に用いた．MedNEの語彙制限についてはn_in3,5,8，r_in0.5,0.7,0.9とし，MEDISおよびMedNEからの修飾語獲得についてはf_min1,2,3,5,8,10として，同様に最適値を決定した．その結果，n_out=n_in=3，r_out=0.7，r_in=0.5，f_min=3(MEDIS)，f_min=3(MedNE)が最適値として得られた．また，素性のウィンドウサイズについては，基本素性（形態素，品詞，品詞細分類，字種，基本形）を素性セットとしたモデルを用いて次のように決定した．サイズは各素性について共通の値を使用することにし，候補を3（-1から1），5（-2から2），7（-3から3），9（-4から4）の4通りとした．続いて，サイズおよびハイパーパラメータcの値を変えながら，訓練データで交差検定を行ったところ，サイズ5において最大のF値が得られ，この値を最適値とした．次節以降，サイズ1で固定しているモダリティ素性を除き，すべての素性に関してサイズ5として実験を行った結果を報告する．</subsection>
  <subsection title="基本素性の有効性の評価">形態素，品詞，品詞細分類，字種，基本形からなる素性セットを基本素性とし，これら5つの素性の有効性の評価を行った．各素性に対するテストデータでの精度を表に示す．表中の``P''，``R''，``F''はそれぞれ適合率，再現率，F値を意味し，``2-way''はモダリティ属性を考慮しない場合の精度，``Total''は考慮した場合の精度を表す．なお，表には，各素性セットに対して30回行った試行の平均精度を記載した．次節以降の実験結果についても同様である．直前の行中の素性セットを用いた場合との差について両側t検定を行い，有意水準1%で有意であった場合に``^''を付した．品詞素性の導入により，2-way，Totalの両評価で，適合率が4ポイント前後向上し，再現率が1.5〜2ポイント程度向上した．訓練データでは，名詞，接頭詞であるトークンのうちのそれぞれ20%弱，30%弱が固有表現（を構成するトークン）であり，残りの品詞については，いずれも97%以上が非固有表現であった．したがって，品詞が名詞または接頭詞であることが固有表現である可能性を示す手がかりとなり，その他の品詞であることが固有表現でないことを示すほとんど確実な手がかりとなったと考えられる．品詞細分類素性の導入では，両評価とも多少の適合率の低下が見られたものの，それを上回る2.5ポイント前後の再現率の向上が得られた．名詞の細分類全体の約30%に相当する「数」では，その99%以上が非固有表現であり，合わせて名詞の約50%に相当する「一般」，「サ変接続」，「接尾・一般」は，各20〜40%を固有表現が占めた．したがって，名詞の中のどの細分類であるかという情報が精度向上に寄与したと考えられる．字種素性の導入による主な変化として，2-way，Totalでの適合率がそれぞれ0.3ポイント程度向上した．固有表現が大きな割合を占めた字種は，「漢字」と「カタカナ」で，それぞれ30%強，20%強の割合であった．ただ，接頭詞および名詞／接尾・一般の100%近い割合を「漢字」が占めるなど，品詞や品詞細分類素性と重複している情報も多い．名詞／一般，名詞／サ変接続のそれぞれ85%程度が「漢字」と「カタカナ」となっており，字種素性がこれらの品詞細分類を詳細化する役割を果たしたと考えられる．基本形素性の導入の結果，主にTotalでの適合率，再現率が向上した．「ない」「なかった」など表層が異なるモダリティ表現を基本形で同一視することで，モダリティ属性を考慮した評価の結果が向上したと考えられる．</subsection>
  <subsection title="モダリティ素性の有効性の評価">モダリティ素性の有効性を評価するため，基本素性のみを用いたシステム（Basic；表の最下行と同一のシステム）と，基本素性に加えてモダリティ素性を用いたシステム(Basic+Modality)の精度の比較を行った．テストデータにおける各モダリティ属性および全体の精度を表に示す．なお，モダリティ属性とは，症状・診断名に付加されているモダリティの種類（positive，negation等）を指し，モダリティ素性は，モダリティ属性を捉えるために用いた素性を指す．BasicとBasic+Modalityとの差について両側t検定を行い，有意水準1%で有意であった場合に``^''を付した．各属性における適合率と再現率は，negationとsuspicionの適合率を除いて，モダリティ素性導入後の方が同等か高いという結果が得られた．属性全体(``All(total)'')で見ても各精度は向上しており，本素性が正確なモダリティ属性の認識に寄与したといえる．なお，本素性の導入前，後ともに，他の属性に比べてsuspicion属性の精度が低いのは，データのアノテーション誤りに起因すると考えられる．著者らが訓練データを確認したところ，「疑い」などの表現が後続する固有表現で，suspicionという属性が付与されていない（positiveとなっている）事例が十数件存在し，suspicionの事例全体の十数パーセントという少なくない割合を占めていた．一方，モダリティ属性を考慮しない2-wayの評価では，適合率が1ポイント弱低下した．「〜がない」などの表現は固有表現でない語句の後方にも出現するため，非固有表現を誤って固有表現と認識してしまうケースが増加し，適合率低下の原因となったと考えられる．</subsection>
  <subsection title="主要語辞書および修飾語辞書利用の有効性の評価">主要語語彙制限および拡張マッチングの有効性を評価するため，基本素性のみのシステム(Basic)と，基本素性に加えて各種辞書に基づく辞書素性を用いたシステムの比較を行った．結果を表にまとめる．最左列は利用した辞書を示しており，``main(X)''は辞書Xを主要語辞書として使用したことを，``modify(X)''は辞書Xを修飾語辞書として拡張マッチングを行ったことを意味する．辞書Xに対して，節の方法による語彙制限を行っていないものを``X-r''(raw)，行ったものを``X-f''(filtered)で表し，辞書Xから獲得した修飾語集合を``X-s''(substring)で表した．また，``X''で2つの辞書X，Yを統合した辞書を表した．数値右上のシンボルは両側t検定によって有意水準1%で有意差があった場合に付しており，``''が(a)と(b)または(c)との比較，``''が(b)と(d)との比較，``''が(c)と(e)との比較，``''が(e)と(f)または(g)との比較の結果を示している．まず，語彙制限を行っていない辞書を単純に利用した場合，MEDIS病名マスター（表中のMDM；MEDISDiseaseNameMaster）に基づく辞書素性を導入した(b)で，2-wayの評価において適合率・再現率が0.7〜1.5ポイント程度向上し，その結果，F値が約1.1ポイント向上した．TotalにおいてもF値が向上したものの，2-wayよりは効果が小さく，認識された症状・診断名の中にモダリティ属性の分類に誤ったものが含まれることが示唆される．なお，2-wayとTotalのいずれの場合も，F値の向上は統計的に有意であった．一方，MedNE（表中のMNE）を追加した場合(c)では，再現率が大きく低下した．訓練データでの交差検定では96%を超えるF値となっており，正解ラベルとほぼ一致する辞書素性に基づく過学習が起こり，他の素性の情報が学習されなかった可能性が高い．上記のような問題を避けるため，次に語彙制限を行った主要語辞書を使用した．結果を見ると，MEDISのみの(d)では全体的にF値がわずかに低下した．これは，MEDIS病名マスターから獲得した主要語については語彙制限の必要性が薄いことを示している．一方，MEDISに加えてMedNEにも語彙制限を加えた(e)では，語彙制限を加えない(c)に比べて適合率，再現率，F値とも大幅に向上した．モダリティ属性まで考慮したTotalでは(b)よりもわずかに精度が低いものの，モダリティ属性を考慮しない2-wayの評価では，これまでの設定で最も良い結果が得られた．最後に，語彙制限を加えた主要語辞書(e)に加えてさらに拡張マッチングを適用した．その結果，MEDISから獲得した修飾語辞書のみを使用した(f)で約0.5〜0.6ポイント，MedNEから獲得した修飾語辞書を併せて使用した(g)で約0.6〜0.7ポイントのF値の向上が見られ，修飾語辞書の導入・語彙増加にともない，わずかながらも着実な認識精度の向上が得られた．</subsection>
  <subsection title="システム全体の性能および従来手法との比較">基本素性，辞書素性，モダリティ素性，後処理ルールを含めたシステム全体の性能の評価を行った．テストデータでの精度を表(a)に示す．基本素性に加えて語彙制限後の2つの辞書と修飾語辞書に基づく辞書素性を導入したシステム（表の最下行(g)のシステム）をModifyとし，モダリティ素性の追加，後処理ルールの適用をそれぞれModality，P-rulesで表した．なお，モダリティ素性と後処理ルールはモダリティ属性まで含めた分類(Total)において利用する．表中のシンボル``''はModifyとModify+P-rules，``''はModifyとModify+Modalityを，``''はModify+ModalityとModify+Modality+P-rulesを比較した際，両側t検定で有意水準1%の有意な差があったことを示している．モダリティ素性の導入後には，適合率，再現率，F値がそれぞれ1ポイント前後向上し，その効果が確認された．また，後処理ルールについては，Modifyに適用した場合でF値で1ポイントの向上，Modify+Modalityに適用した場合で0.7ポイント程度の向上が得られた．すなわち，CRFによって症状・診断名と認識された語句に対してのみモダリティ属性を修正する処理を行うことで，症状・診断名の認識精度を維持したまま，モダリティ属性分類誤りを減少できている．なお，後処理ルールの効果を確認するため，訓練データを使用して，ModifyおよびModify+Modalityの推定結果に後処理ルールを適用した場合の正解数の変化について表に示した．象件はルール適用の対象となった固有表現の件数で，システムが正例と推定した固有表現の数に相当する．また，``TF''，``FT''および``FF''は，ルール適用前に正解(T)／不正解(F)であったものが，ルール適用後に正解／不正解に変化した件数を表す．``合計''はこれら3つの値の合計で，ルールが適用された件数に相当する（``TT''となったもの，つまり，モダリティ属性が変化しなかったものについては，件数に含めていない）．Modifyに適用した場合では，適用対象件数の5%弱にあたる81件に対してルールが適用された．適用された事例のうち，実際に固有表現であった事例に対する正解率は80%程度であった．Modify+Modalityに関しては，モダリティ素性の導入により周辺文脈と矛盾するモダリティ属性の推定結果が減ったと考えられ，ルールが適用された件数自体が減少した．しかし，ルールの適用により僅かながら正解数が増加している．表(a)の下半分には，MedNLP症状と診断タスクの成績上位3チームであるMiuraら，LaquerreらおよびImaichiらのシステムの精度を掲載した．従来手法の中では，Totalの適合率を除き，いずれもMiuraらのシステムの精度が最も高い．これに対し，Totalの評価で比較すると，本システムは適合率を中心に従来手法よりも高く，モダリティ素性と後処理ルールを併用したシステム(Modify+Modality+P-rules)では，適合率，再現率，F値ともに最も高くなっている．また，提案システムと従来手法の中で精度が高いMiuraらのシステムについて，モダリティ属性ごとの精度を表(b)に掲載した．Miuraらのシステムではpositiveおよびnegationの再現率が高く，多数派クラスの網羅的な抽出の点で優れている．しかし，適合率ではどの属性についても本システムの方が高く，特に，少数派クラスであるsuspicion，familyの認識では，適合率，再現率ともに大きく上回っている．したがって，モダリティ属性の分類を含めた抽出では，従来手法と比べて，我々の手法が最も正確な用語抽出を実現できており，事例数の少ないクラスに対して頑健な推定を実現できているといえる．一方，表(a)における2-wayの評価では，特に，再現率がMiuraらのシステムと比べて3ポイントほど低く，本システムは症状・診断名抽出の網羅性の点で劣っている．修飾語の付加を行う拡張マッチングでは，主要語が主要語辞書に含まれない場合には対応できないという限界があるため，再現率を高めるには，コーパスから修飾語だけでなく新たな主要語も獲得する方法が必要となる．また，診療記録中の症状・診断名と共起しやすい「〜出現」「〜増悪」などの表現は，未知の主要語を認識する際の手がかりとして有効利用できる可能性がある．</subsection>
  <section title="おわりに">本稿では，症例検索などの基礎技術として重要である症状名・診断名の抽出に焦点を当て，語彙資源を有効活用した用語抽出について報告した．語彙資源活用の1点目として，コーパス中の用語に対して語彙制限を行うことで，用語抽出に真に有用な語彙の獲得を行った．2点目として，コーパスから複合語の構成語彙である修飾語を獲得し，語彙制限後のコーパスの語彙に加えて獲得した修飾語を活用することで，テキスト中のより多くの用語を検出する拡張マッチングを行った．検出された用語の情報は，機械学習アルゴリズムlinear-chainCRFをベースとしたシステムの素性として使用した．NTCIR-10MedNLPタスクのテストコレクションを用いて抽出実験を行ったところ，単純な辞書の利用と比較して，F値で0.4〜1.1ポイントの有意な精度向上が見られ，語彙制限および拡張マッチングの有効性を確認した．症状・診断名の認識では，同タスクで1位のMiuraらのシステムと比較し，モダリティ属性の分類を含めた認識では本システムが適合率・再現率ともに高い精度を実現した．一方，モダリティ属性を考慮しない場合の症状・診断名認識において再現率が低く，網羅性の点で劣っていた．語彙制限および修飾語の付加に基づく拡張マッチングでは，元の語彙資源に含まれない主要語に対応できないという限界があるため，今後の課題として，新たな主要語の獲得や，未知の主要語を認識する方法が必要である．また，NTCIR-10MedNLPに続くシェアドタスクであるNTCIR-11MedNLP2では，表記が異なりかつ同一の対象を指す症状・診断名を同一視する「病名・症状正規化タスク」が設定されている．症例検索などの応用に向けた基礎技術として，幅広い症状・診断名を抽出することに加え，抽出した症状・診断名の表記の違いを吸収する技術の開発も重要である．-10MedNLPタスクを主催され，MedNLPテストコレクションをご提供くださいました京都大学デザイン学ユニットの荒牧英治特定准教授ならびに関係者の皆様に感謝申し上げます．MEDIS病名マスターをご提供くださいました一般財団法人医療情報システム開発センターの関係者の皆様に感謝申し上げます．また，本研究の一部は，JSPS科学研究費補助金25330363，ならびに私立大学等経常費補助金特別補助「大学間連携等による共同研究」の助成を受けたものです．</section>
  <section title="モダリティ素性における正規表現">モダリティ素性において，各属性のモダリティ表現を捉えるために用いた正規表現を記載する．各正規表現の記述形式は，プログラミング言語Pythonでの正規表現に準拠している．なお，``X|Y''はXまたはYとの一致，``[X_1X_2X_N]''はX_1,X_2,,X_Nのいずれかとの一致，``()''はパターンのグループ化，``?''は直前のパターンの0回または1回の出現を表す．また，``(?!)''は否定先読みアサーションと呼ばれ，``X(?!)''として用いられた場合に，``''に相当する文字列が後続しないXにマッチする．</section>
  <section title="修飾語の限定に用いたひらがな表現">語彙資源から修飾語を獲得する処理において，修飾語の限定の際に用いた主にひらがなから構成される表現を以下に記載する．document</section>
</root>
