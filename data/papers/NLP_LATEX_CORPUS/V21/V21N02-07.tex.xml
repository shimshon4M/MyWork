<?xml version="1.0" ?>
<root>
  <jtitle>『現代日本語書き言葉均衡コーパス』形態論情報アノテーション支援システムの設計・実装・運用</jtitle>
  <jauthor>小木曽智信中村壮範</jauthor>
  <jabstract>『現代日本語書き言葉均衡コーパス』は1億語を超える大規模なコーパスであり，17万ファイル以上のXML文書に短単位・長単位の形態論情報アノテーションが施されている．このコーパスの構築を目的としてアノテーションのためのシステムが開発された．このシステムは，辞書見出しデータベースと，タグ付けされたコーパスとを関連付けて，整合性を保ちつつ多くの作業者が編集していくことを可能にするものである．このシステムは，関係データベースで構築されたサーバ「形態論情報データベース」と，辞書を参照しながらコーパスの修正作業を可能にするコーパス修正用のクライアントツール「大納言」，形態素解析辞書UniDicの見出し語の管理ツール「UniDicExplorer」から成る．本稿はこのデータベースシステムの設計・実装・運用について論ずる．</jabstract>
  <jkeywords>コーパス管理ツール，現代日本語書き言葉均衡コーパス，UniDic</jkeywords>
  <subsubsection title="">*語頭・語末変化語頭・語末変化テーブルは，語形が持つ語頭・語末変化型に応じた語頭・語末文字の変化パターンを記した表であり，語形・書字形の見出し語の語頭・語末変化形を語彙表に展開する処理で使用される．実体は辞書データベース内の語頭変化テーブル・語末変化テーブルである．語頭変化テーブルの主要な項目を表に示す（語末変化テーブルは語頭変化テーブルと同様のため省略する）．主な対象は連濁現象で，例えば「カライ（辛い）」の「語頭変化型」に「カ濁」を設定すると，語頭変化表により基本形「カライ」と，語頭文字を置き換えた濁音形「ガライ」が生成される．データベース上では，この変形は語形テーブルと語頭変化テーブルを語頭変化型で結合することで，各形を生成している．書字形のレベルでは，濁音形の書字形は，漢字表記の場合には基本形と同じものが使われる（例：辛い）が，ひらがな・カタカナで表記されている場合には書字形の先頭部分を変化させたもの（例：がらい・ガライ）を生成する．語末変化も語頭変化と同様で，「語形」が持つ「語末変化型」に応じて，語形変化した形を生成する．例えば「サンカク（三角）」の語末変化型に「ク促」を設定すると，語末変化表により，基本形「サンカク」と，語末文字を置き換えた促音形「サンカッ」を生成する．</subsubsection>
  <section title="はじめに">国立国語研究所を中心に開発された『現代日本語書き言葉均衡コーパス（BCCWJ）』は17万ファイル以上のXML文書に短単位・長単位の二つのレベルの形態論情報アノテーションを施した，1億語を超える大規模なコーパスである．コーパスの構築期間は5年以上に及んだ．BCCWJの形態論情報付与には，新たに開発された電子化辞書UniDicが用いられたが，UniDicの見出し語はBCCWJ構築と並行して整備されたため，コーパスの形態論情報の修正とUniDicの見出し語登録は整合性を保ちつつ同時並行で進める必要があった．また，BCCWJの形態論情報アノテーションでは全体で98%以上の高い精度が求められ，これを実現するためには自動解析結果に対して人手による修正を施して精度を高める必要があった．1億語規模のコーパスにこうしたアノテーションを施すためには，作業体制も大きな規模になり，コーパスのアノテーターは最大で20人ほどが同時にフルタイムで作業に当たった．作業は国語研究所の内部だけでなく，外注業者等の研究所外部からも行われる必要があった．こうした作業環境を構築するためにはアノテーションを支援するコーパス管理システムが必要とされる．このような大規模なコーパスへのアノテーションを支えるため，筆者らは，形態論情報がタグ付けされた大規模なコーパスと辞書の見出し語のデータベースとを関連付け，整合性を保ちつつ，国語研究所の内部だけでなく，研究所外部からも多くの作業者が同時に編集していくことを可能にするシステムを新たに開発した．本論文は，この「形態論情報データベース」の設計・実装・運用について論ずる．本研究の貢献は，1億語規模の日本語コーパスに形態論情報アノテーションを施し，修正することを可能にした点にある．従来のコーパス管理ツールではこれが実現できなかったが，本システムによりBCCWJの形態論情報アノテーションが可能になり，BCCWJを構成する全てのデータは本システムのデータベースから出力された．また，本システムによってUniDicの見出し語のデータ整備を支援し，UniDicの見出し語と対応付けられた人手修正済みの学習用コーパスを提供した．これにより，形態素解析辞書UniDicの開発に貢献した．このシステムは，現在では「日本語歴史コーパス」-0.5zwの構築にも活用されている．以下，2章で本論文の前提となる情報について確認した後，3章で関連する先行事例との比較を行う．そのうえで，4章で本システムの概要を説明し，5章で辞書データベース部，6章でコーパスデータベース部の設計・実装・運用について述べる．また，7章で辞書とコーパスを修正するためのクライアントツールについて説明する．</section>
  <section title="前提となる知識"/>
  <subsection title="短単位と長単位">BCCWJでは，短単位と長単位の二つの言語単位によるアノテーションが施された．短単位は，揺れが少なく斉一な単位となるように設計された短い単位である．例えば「国立国語研究所で研究している．」という文は，次の10単位に分割される．個々の短単位には，語彙素・語形・品詞・活用型・活用形といった形態論情報が付与される．短単位への分割と情報の付与は，新たに開発された電子化辞書UniDicを用いた形態素解析によって行われた．形態素解析器はMeCabが用いられた．一方，長単位はほぼ文節に近い長さの言語単位で，上記の例は長単位では次のように5単位に分割される．長単位は，コーパス中で出現した短単位を必要に応じて結合させる形で構成され，個々の長単位にはそれを構成する短単位が持つ形態論情報をもとにして長単位としての形態論情報が付与される．この処理は，長単位解析器Comainu~によって行われた．Comainuの処理により，例えば上の例の「研究し」には，短単位「研究」と「する」を結合して作られる「研究する」という長単位の見出しが付され，全体として一つの動詞として情報が付与される．このように，短単位は形態素解析用の辞書に見出し語として登録されたものであるのに対し，長単位はそれ自体は見出し語として登録されたものではなく，コーパスでの出現に応じて短単位情報をもとにして構成されるものである．長単位と短単位はBCCWJの最も基本的なアノテーションの一つであり，公式のコーパス検索ツール「中納言」-0.5zw等で利用され，多くのユーザーによって活用されている．</subsection>
  <subsection title="形態論情報の精度と修正作業">BCCWJの形態論情報は，コアデータとして選定された約100万語は99%以上の精度を，それ以外の非コアデータは98%以上の精度を確保することとされた．この解析精度を実現するために，コアデータについては人手による徹底した修正が行われた．一方，非コアデータは原則として自動解析結果によったが，最終的には人手による修正も含めてこの精度が確保された．また，非コアデータからUniDic未登録語が採集され，それに伴う修正をコーパス全体に対して行う必要があったほか，短単位規程の見直しによってコーパス全体に対して特定の語の人手修正の処理を施す必要があった．したがってコーパスの修正作業はコアデータに対して頻繁に行われるだけでなく，1億語以上のコーパス全体を対象に行う必要があった．</subsection>
  <subsection title="C-XMLとM-XML">BCCWJでは，C-XMLとM-XMLの二つの形式のXML文書が作成された．C-XMLは，BCCWJのサンプルとして取得されたテキストに文書構造をXMLでアノテーションしたもので，形態論情報データベースにとっては入力となるデータの形式である．このXML形式のデータをインポートし，形態論情報をアノテーションした上で，表形式やXML形式で出力することがこのシステム全体の処理の流れになる．M-XMLはC-XMLをもとに形態論情報をアノテーションしたXML文書で，このシステムの出力形式の一つである．M-XMLでは，後述する数字の前処理や，一部のタグの変更が行われているため，テキストやタグはC-XMLとは必ずしも一致しない．なお，誤字修正などがシステム上で行われるため，M-XMLだけでなく，形態論情報を含まないC-XMLも最終版は形態論情報データベースから出力される必要がある．</subsection>
  <subsection title="数字の前処理">BCCWJの形態論情報付与では，UniDicを用いた形態素解析に先立って，数字について次のような変換処理がなされた．これは，テキスト中の数字に対して実際に読み上げるときの語として形態論情報を与えられるようにするためである．この処理はnumTrans~というルールベースのツールによって行われた．この処理により処理前後で文字位置がずれたり，分数の分子と分母で文字の順が逆になったりすることがある．上述のC-XMLはこの変換前のテキストであるのに対し，M-XMLは変換後のテキストに基づいており，これに変換処理の内容（原文文字列と変換タイプ）をXMLでタグ付けして保持している．このため，BCCWJを構築するためのシステムは，この変換処理前後の二つの状態のテキストを適切に保持管理する必要がある．</subsection>
  <section title="関連する先行事例との比較"/>
  <subsection title="BCCWJの形態論情報アノテーションのための要件">章・章で確認したことを踏まえるとBCCWJに形態論情報のアノテーション施すためには，少なくとも次の要件を満たすシステムが必要とされる．	1億語規模のコーパスを格納して実用的な検索や修正が行えること	辞書を参照しその情報を用いてコーパスのアノテーションが行えること	辞書（語彙表）とコーパスとを同期して整合性を保つことができること	形態素解析によって付与された単語境界を容易に修正可能なことBCCWJの修正作業では節で見たとおり，1億語規模のコーパスを対象に，同様の誤りを一括して修正する必要がある．したがって，(i)は最も重要な要件である．さらに，BCCWJの構築では，階層構造を持つ新しい電子化辞書UniDicのために専用の辞書データベースを用意し，その見出し語を用いてコーパスを修正する必要があった．また，辞書とコーパスが同時並行で拡張されることから，辞書とコーパスを関連付けて管理し，整合性を保つことが必要となる．したがって，(ii)(iii)の辞書連携の機能も欠くことができない．これに加えて，分かち書きがなされない日本語のテキストを対象とすることから，(iv)の要件も強く求められる．英語を初めとする分かち書きがなされる言語では，既存の境界にしたがって単語に対してアノテーションを付与すれば良いため，単語境界の修正は重要な問題ではない．しかし日本語では，自動形態素解析によって分割された単語の境界自体が誤っている場合が少なくないため，境界を変更する修正が頻繁に行われるからである．</subsection>
  <subsection title="既存のアノテーションツールとの比較">人手による修正を加えた日本語コーパスで，1億語を超える規模のものはこれまでに構築されてこなかったこともあり，管見に入る限り，前節の要件を完全に満たす先行事例は存在しない．しかし，コーパスへのアノテーション支援ツールには多くの実装がある．既存のツール類が上記の条件をどの程度満たしているのかを調査した．取り上げたのは，次の4つの実装である．多くのツールの中で，日本語の形態論情報付きコーパスの管理ツールとして実績があるChaKiの最新版と，比較的最近になって発表されたツールに注目した．ChaKi.NETBRATSLATEAnotatorniaBRATはWeb上での使いやすいインターフェイスを備える汎用のアノテーションツールであり，係り受け・固有表現・照応・句のチャンキングなどのアノテーションに利用されている．SLATEもまたWeb上で容易に使える汎用のアノテーションツールであるが，さらにアノテーションの版管理まで考慮したものになっている．Anotatorniaはポーランド語のコーパス(NationalCorpusofPolish)構築のために開発されたアノテーションツールで，形態素解析辞書との連携が可能である．これら4つのツールと，本研究のシステムについて，前節でみた要件と，利用のしやすさ，実装に利用されている技術の観点から比較した結果を表1にまとめた．表中，「○」は条件を満たすもの，「△」は限定的に要件を満たすもの，「×」が満たさないものである．表のうち，BCCWJの構築にとって最も重要なのは，前節で確認したとおり，大規模データへの対応，単語境界修正，辞書連携の機能である．BRATとSLATEは，いずれもWeb上で動作する汎用のアノテーションツールとして開発されたものであり，表において両者とも同じ結果となっている．これらWeb上の汎用ツールは，導入の敷居が低く作業者も容易に利用が可能だが，比較的少数の文書ファイルに対してアノテーションを施すことを前提としており，BCCWJ構築のように，大量の文書を一度に修正するような作業には向いていない．また，一般に単語よりも上位のレベルでのアノテーションに用いられることを想定していると思われ，文字列を単位としたアノテーションが可能ではあっても，単語境界の修正に適したツールにはなっていない．また，多くの語の形態論情報を一括で修正するような作業には向かない．Anotatorniaは単語境界の修正や辞書連携が可能であるが，ポーランド語の特定の電子辞書に対応したものであるため，BCCWJでの利用には適さない．また，DBMSに軽量なSQLiteを用いたWebベースのシステムであるため，大規模データの処理にも向かないと考えられる．ChaKiは，日本語コーパス管理に関係データベースを用いるの設計にもとづき，前節で見たような日本語の形態論情報アノテーションの特徴を踏まえたコーパス管理システムとなっている．そのため，単語境界修正や辞書との連携が可能であるうえに，係り受けやチャンキング，グループ化など多様なアノテーションを可能にしている．しかし，大規模データへの対応で難があり，現在のChaKi.NETの実装では1,000万語を超えるコーパスを格納すると実用的な速度が出ず，多数の作業者が十分な速度と同時実行性を以て利用することはできなかった．</subsection>
  <subsection title="本システムの優位性と問題点">前節で確認したとおり，最も重要となる大規模データへの対応，単語境界修正，辞書連携の3つを満たすシステムは，本システムしか存在しない．日本語の形態論情報アノテーションに適した機能を持ち，１億語を超える規模のコーパスを一度に取り扱うことを可能にしたこと，そして辞書データベースとの完全な連携が本システムの特長である．本システムはBCCWJにあわせて作り込まれているため，章で挙げたBCCWJ独自の処理にも対応している．また，階層構造をもつUniDicの辞書データベースを包含しており，アノテーションツールに留まらない言語資源管理のシステムとなっている．一方で，本システムにはいくつかの問題点も存在する．BCCWJに特化した設計となっているため汎用性に乏しいこと，Webベースのシステムではないためクライアントソフトウェアの配布が必要であり導入の敷居が高いこと，フリーウェアではなくプロプライエタリなソフトウェアを用いて構築されているため配布が難しいこと，などは他のシステムと比較して劣る点である．</subsection>
  <section title="形態論情報データベースシステムの概要"/>
  <subsection title="形態論情報データベースの構成">形態論情報データベースは，UniDicの見出し語を格納する「辞書データベース」と，コーパスを格納する「コーパスデータベース」から構成される．図にその全体図を示す．形態論情報データベースは，UniDicの見出し語を管理する部分と，コーパスを格納して修正を行う部分に分かれる．これに対応するように，データベースをインスタンスのレベルで，辞書見出しを格納する「辞書データベース」部と，コーパスを格納する「コーパスデータベース」部に分割した．そのうえで，コーパスの形態論情報と辞書の情報を同一に保つために，見出し語表・活用表・変化表などから生成される「語彙表」を挟んで二つのデータベースを連係させた．辞書データベースには，短単位の見出し語表と，これを出現形まで展開するための活用表・変化表が含まれる．辞書データベースの詳細は章で述べる．辞書見出しを出現形まで展開した「語彙表」はレコードごとに語彙表IDが一意に割り振られ，コーパスデータベース内に生成される．コーパスデータベースには，BCCWJのテキストを形態素解析した短単位のコーパスが含まれる．コーパスのレコードは語彙表IDにより語彙表と関連付けられ，これを介して辞書の見出し表と関連付けられる．なお，コーパスデータベースには短単位を組み上げた長単位の情報が含まれる．長単位は定義上，コーパスに出現したものをそのまま単位として認める形をとるため，辞書データベースとは接続されない．コーパスデータベースの詳細は章で述べる．コーパスと辞書は独立性が高く，それぞれが単独でも利用できる必要があるため，コーパスにも辞書データベースがもつ多様な情報が付与されている．次節で見るように，辞書データベースのデータが変更された場合は，語彙表を介してコーパスにも変更が反映される．</subsection>
  <subsection title="語彙表展開とコーパスとの同期処理">コーパスデータベースと辞書データベースを連携するための仕組みとして語彙表展開と同期処理が重要であるが，この処理は本システムの中でも最もコストのかかる処理のひとつである．BCCWJはコーパスの規模が大きいために出現頻度が数万以上となる見出し語も少なくない．仮に語彙表展開とコーパスとの同期を全てリアルタイム処理で行うとすると，こうした見出し語を変更した場合のコーパスとの同期処理には大きな負荷がかかり，レコードロックなどが頻発し作業上深刻な問題となる可能性がある．そのため，データの変更が及ぼす影響の範囲や処理の必要性に応じて，リアルタイム処理と，通常深夜に行われる日次処理とを使い分けている．見出し語の変更による当該語の語彙表展開は，語彙表への影響も少なく，また変更した語を即座にコーパス修正に使用できるようにする必要があるためにリアルタイム処理としている．一方，活用表や変化表の変更によって生じる語彙表展開と同期処理では，影響を受ける見出し語が多数にのぼり，関連付けられたコーパスの更新箇所も膨大となる可能性があるため，リアルタイム処理ではなく日次処理により行っている．このようにシステムへの負荷を軽減し作業性を上げるために，辞書データベースとコーパスデータベースはリアルタイムの同期処理のみによる密結合ではなく，日次処理を含めたゆるやかな連携をとる疎結合のシステムとして設計されている．辞書データベースとコーパスデータベースとの関連付けには，語彙表テーブルが保持する語彙表IDを用いるが，語彙表テーブルはコーパスの各語が持つ属性値も保持している．語彙表IDと属性値で二重に情報が保持されているため，語彙表IDでの接続が失われた状態でも，属性値の組み合わせにより語彙表（及び辞書データベースの見出し語表）との接続を回復できる．これにより，見出し語の修正によって語彙表IDが変わってしまった場合や，コーパスの修正によって一部の属性が一括変更された場合など，コーパスと語彙表の関連づけが失われた際にも，語彙表IDか属性値のいずれかをキーとして同期をとることができるようにした．語彙表の更新は，見出し語表の見出し語の追加時・修正時にリアルタイムで該当する語彙表のレコードを自動生成・更新する．これにより辞書追加した語をすぐにコーパス修正に利用できるようにしている．また日次のバッチ処理により上述のコーパスと語彙表との同期処理を行い，語彙表IDと属性値のいずれによっても対応がとれないレコードが発生した場合には作業者に修正を促すことで関連付けを保っている．</subsection>
  <subsection title="利用したシステム">形態論情報データベースで使用した主な機器・ソフトウェアは以下のとおりである．クライアント		ソフトウェア				OS:MicrosoftWindowsXP（後に7に更新）		ツール開発：MicrosoftAccess2003（後に2007に更新）			サーバ			ソフトウェア				OS:MicrosoftWindowsServer2003R2x64（後に2008R2に更新）		DBMS:MicrosoftSQLServer2005StandardEditionx64				ハードウェア			機種：DELLPowerEdge2950		メモリ：24.0GB		CPU:IntelXeonX5355（2.66~GHz4コア2×4~MBL2キャッシュ1333~MHzFSB）×2		HDD:300~GB15000~rpmSAS×6（RAID5構成で実質容量1.5~TB）		バックアップストレージ			ハードウェア		機種：DELLPowerVaultMD-1000	HDD:1~TBSATA×15（うち2台がホットスペア，RAID5構成で実質容量11~TB）		形態論情報データベースは1台のデータベースサーバに複数の端末からアクセスするクライアント・サーバ型のシステムとして構築されている．プロジェクト開始までの開発期間が限られていたこと，運用中も頻繁な仕様変更が想定されたことなどから，機能追加・変更が容易に行えるAccessでクライアントツールを開発し，DBMSにはAccessとの親和性が高く，データベース管理，分析，チューニング等のツールが充実しているSQLServerを採用した．DBMSはBCCWJの電子テキスト化で用いられるJISX0213の文字集合を適切に扱える必要があったが，BCCWJ構築開始時点で当該文字集合が適切に扱えるものが少なく，このこともSQLServerを採用した理由となっている．なお，所外の作業者などAccessがインストールされていない環境からも作業ができるよう，無償配布されているAccessランタイム上で動作するクライアントツールの外部接続用インストールパッケージを別途用意した．</subsection>
  <section title="辞書データベースの設計と実装"/>
  <subsection title="見出し語表の設計と実装">辞書データベースは，形態素解析辞書UniDicの元となるデータベースである．見出し語表のほか，活用表などの辞書作成に必要な情報からなる．UniDicでは図のような見出し語の階層構造が設定されている．「語彙素」は国語辞典の見出し語に相当するレベル，「語形」は異語形を区別するレベル，「書字形」は異表記を区別するレベル，「発音形」は発音を区別するレベルである．辞書データベースの見出し語表は，の基本設計を踏襲し，このUniDicで設定されている見出し語の階層構造をそのまま反映させる形で実装した（図）．辞書データベースの基本となる見出し語表を構成するのは「短単位語彙素」「短単位語形」「短単位書字形」「短単位発音形」の4つの見出し語のテーブルである．4つの見出し語のテーブルはそれぞれ一意のIDによって関連付けられており，各IDは計算によってテーブルの階層関係が確認できるように設計した．例えば，語形IDは親となる語彙素のIDに32（一つの語彙素が持ちうる語形の最大数）を乗じたものに自身の語形SubIDを加えたものを一意のIDとしている．IDで関連付けられたテーブル間では，レコードの生成や削除に関連するデータベース制約を設定し，不正な見出し語のエントリを防いでいる．見出し語のテーブルが持つ主要項目を表に示す．UniDicでは，語彙素・語彙素読み・語彙素細分類・品詞・語形・活用型・書字形・発音形（表の列名に◎を付した）の組み合わせによって，見出し語が一意に区別される．辞書データベースの見出し語のテーブルでもこの関係を外部キー制約として記述し，見出し語の二重登録を防いだ．表の項目に加え，見出し語のテーブルに表の項目を共通して持たせ，各見出し語のメタ情報を記録した．これにより，見出し語を追加・修正した際の作業者やソースのトレースを可能にし，誤った見出し語の追加・修正への対処を可能にしている．また，状態属性によりジャンル別の形態素解析辞書の作成を可能にしている．</subsection>
  <subsection title="語彙表展開の設計と実装">辞書データベースには，見出し語のテーブルのほかに，活用語を展開するための「活用表」テーブル，語頭・語末変化形を展開するための「語頭変化」「語末変化」テーブルを置き，見出し語をコーパス上に出現する形にまで展開させる．この処理を語彙表展開と呼び，「語頭変化」→「語末変化」→「活用形展開」の順に，見出し語を展開することで行う．以下，この処理の内容について述べる．</subsection>
  <subsection title="辞書データベースの運用"/>
  <subsection title="辞書データのエクスポート">辞書データベースは，コーパスデータベースの修正に用いられるだけでなく，形態素解析用の辞書（見出し語リスト）を出力する役割も担っている．辞書データベースから出力された辞書と，コーパスデータベースから出力される人手修正済みの学習用コーパスを利用して形態素解析辞書が作成された．UniDic1.x系列の形態素解析辞書の作成に当たっては，辞書データベースの見出し語表・活用表・語頭語末変化表を組み合わせて展開した語彙表を表形式テキストとして出力し，これをMeCab用の辞書のソースデータとして提供した．さらに，見出し語のテーブルを結合・再構成してUniDicの階層構造を再現したXML形式で出力し，UniDic2.x系列の辞書データとして提供した．同時に活用表や語形変化表もXML形式で出力し，辞書データベースの大部分をXML形式で外部に提供することを可能にした．</subsection>
  <section title="コーパスデータベースの設計・実装・運用"/>
  <subsection title="コーパスデータベースの設計と実装">章で確認したとおり，BCCWJのテキストはXML文書の形で提供される．テキストの形態論情報は，形態素解析等の自動出力結果を人手で修正した後で，元のXML文書に対するアノテーションとして出力する必要がある．BCCWJでは，短単位と長単位という階層的な関係を持つ2つの言語単位によって形態論情報がアノテーションされるが，この階層関係もXMLのタグによって表現される．BCCWJのコアデータから，短単位と長単位のアノテーション例をリスト1に示す．LUWが長単位，SUWが短単位のタグである（一部のタグを省略した）．関係データベースを用いてこうしたXML文書を扱うために，スタンドオフ・アノテーションの方法に基づき，XML文書が含む文字データ（CDATA）とタグをテーブルに分割し，ファイル先頭からの文字オフセット値（タグを除いた文字の開始終了位置）によって関係づけて管理する設計とした．全体の整合性を保持するため，文字やタグを含む全てのデータの修正をこのデータベース上で行う．このデータベースのテーブル関連図を図に示す．コーパスデータベース中のテーブルは，XML文書起源のものとして「文字」テーブル，「タグ」テーブル，「ルビ」テーブル，「文字修正」テーブルがあり，これに後述する数字処理による「数字」テーブル，形態論情報アノテーションとしての「短単位」テーブルと「長単位」テーブルが加わる．形態論情報も文字位置によってテーブルを関連付けて管理する．このほかに，全文検索用の「文」テーブルや長単位修正作業用の「長単位語彙表」テーブルを置く．このうち，コーパスデータベースにとって必須のデータは文字テーブルと短単位テーブルであり，XML文書の復元や長単位アノテーションを必要としない場合にはこれ以外のテーブルは不要となる．コーパスデータベースの根幹である短単位テーブルの主要な項目を表に示す．[title=リスト1短単位と長単位のアノテーション例（X-XML）]&lt;mergedSamplesampleID=&quot;OW6X_00028&quot;type=&quot;BCCWJ-MorphXML&quot;version=&quot;1.0&quot;&gt;&lt;articlearticleID=&quot;OW6X_00028_V001&quot;isWholeArticle=&quot;false&quot;&gt;&lt;titleBlock&gt;&lt;title&gt;&lt;sentencetype=&quot;quasi&quot;&gt;&lt;LUWB=&quot;S&quot;SL=&quot;v&quot;l_lemma=&quot;第一章&quot;l_lForm=&quot;ダイイッショウ&quot;l_wType=&quot;漢&quot;l_pos=&quot;名詞-普通名詞-一般&quot;l_formBase=&quot;ダイイッショウ&quot;&gt;&lt;SUWorderID=&quot;10&quot;lemmaID=&quot;22937&quot;lemma=&quot;第&quot;lForm=&quot;ダイ&quot;wType=&quot;漢&quot;pos=&quot;接頭辞&quot;formBase=&quot;ダイ&quot;pron=&quot;ダイ&quot;start=&quot;10&quot;end=&quot;20&quot;&gt;第&lt;/SUW&gt;&lt;SUWorderID=&quot;20&quot;lemmaID=&quot;2050&quot;lemma=&quot;一&quot;lForm=&quot;イチ&quot;wType=&quot;漢&quot;pos=&quot;名詞-数詞&quot;formBase=&quot;イチ&quot;kana=&quot;イッ&quot;pron=&quot;イッ&quot;start=&quot;20&quot;end=&quot;30&quot;&gt;１&lt;/SUW&gt;&lt;SUWorderID=&quot;30&quot;lemmaID=&quot;16559&quot;lemma=&quot;章&quot;lForm=&quot;ショウ&quot;wType=&quot;漢&quot;pos=&quot;名詞-普通名詞-一般&quot;formBase=&quot;ショウ&quot;pron=&quot;ショー&quot;start=&quot;30&quot;end=&quot;40&quot;&gt;章&lt;/SUW&gt;&lt;/LUW&gt;&lt;LUWSL=&quot;v&quot;l_lemma=&quot;&quot;l_lForm=&quot;&quot;l_wType=&quot;記号&quot;l_pos=&quot;空白&quot;&gt;&lt;SUWorderID=&quot;40&quot;lemmaID=&quot;23&quot;lemma=&quot;&quot;lForm=&quot;&quot;wType=&quot;記号&quot;pos=&quot;空白&quot;formBase=&quot;&quot;pron=&quot;&quot;start=&quot;40&quot;end=&quot;50&quot;&gt;&lt;/SUW&gt;&lt;/LUW&gt;&lt;LUWB=&quot;B&quot;SL=&quot;v&quot;l_lemma=&quot;障害者施策&quot;l_lForm=&quot;ショウガイシャシサク&quot;l_wType=&quot;漢&quot;l_pos=&quot;名詞-普通名詞-一般&quot;l_formBase=&quot;ショウガイシャシサク&quot;&gt;&lt;SUWorderID=&quot;50&quot;lemmaID=&quot;16607&quot;lemma=&quot;障害&quot;lForm=&quot;ショウガイ&quot;wType=&quot;漢&quot;pos=&quot;名詞-普通名詞-サ変可能&quot;formBase=&quot;ショウガイ&quot;pron=&quot;ショーガイ&quot;start=&quot;50&quot;end=&quot;70&quot;&gt;障害&lt;/SUW&gt;&lt;SUWorderID=&quot;60&quot;lemmaID=&quot;15852&quot;lemma=&quot;者&quot;lForm=&quot;シャ&quot;wType=&quot;漢&quot;pos=&quot;接尾辞-名詞的-一般&quot;formBase=&quot;シャ&quot;pron=&quot;シャ&quot;start=&quot;70&quot;end=&quot;80&quot;&gt;者&lt;/SUW&gt;&lt;SUWorderID=&quot;70&quot;lemmaID=&quot;15256&quot;lemma=&quot;施策&quot;lForm=&quot;シサク&quot;wType=&quot;漢&quot;pos=&quot;名詞-普通名詞-一般&quot;formBase=&quot;シサク&quot;pron=&quot;シサク&quot;start=&quot;80&quot;end=&quot;100&quot;&gt;施策&lt;/SUW&gt;&lt;/LUW&gt;&lt;LUWSL=&quot;v&quot;l_lemma=&quot;の&quot;l_lForm=&quot;ノ&quot;l_wType=&quot;和&quot;l_pos=&quot;助詞-格助詞&quot;l_formBase=&quot;ノ&quot;&gt;&lt;SUWorderID=&quot;80&quot;lemmaID=&quot;28989&quot;lemma=&quot;の&quot;lForm=&quot;ノ&quot;wType=&quot;和&quot;pos=&quot;助詞-格助詞&quot;formBase=&quot;ノ&quot;pron=&quot;ノ&quot;start=&quot;100&quot;end=&quot;110&quot;&gt;の&lt;/SUW&gt;&lt;/LUW&gt;&lt;LUWB=&quot;B&quot;SL=&quot;v&quot;l_lemma=&quot;総合的取り組み&quot;l_lForm=&quot;ソウゴウテキトリクミ&quot;l_wType=&quot;混&quot;l_pos=&quot;名詞-普通名詞-一般&quot;l_formBase=&quot;ソウゴウテキトリクミ&quot;&gt;&lt;SUWorderID=&quot;90&quot;lemmaID=&quot;21023&quot;lemma=&quot;総合&quot;lForm=&quot;ソウゴウ&quot;wType=&quot;漢&quot;pos=&quot;名詞-普通名詞-サ変可能&quot;formBase=&quot;ソウゴウ&quot;pron=&quot;ソーゴー&quot;start=&quot;110&quot;end=&quot;130&quot;&gt;総合&lt;/SUW&gt;&lt;SUWorderID=&quot;100&quot;lemmaID=&quot;25076&quot;lemma=&quot;的&quot;lForm=&quot;テキ&quot;wType=&quot;漢&quot;pos=&quot;接尾辞-形状詞的&quot;formBase=&quot;テキ&quot;pron=&quot;テキ&quot;start=&quot;130&quot;end=&quot;140&quot;&gt;的&lt;/SUW&gt;&lt;SUWorderID=&quot;110&quot;lemmaID=&quot;26779&quot;lemma=&quot;取り組み&quot;lForm=&quot;トリクミ&quot;wType=&quot;和&quot;pos=&quot;名詞-普通名詞-一般&quot;formBase=&quot;トリクミ&quot;pron=&quot;トリクミ&quot;start=&quot;140&quot;end=&quot;160&quot;&gt;取組&lt;/SUW&gt;&lt;/LUW&gt;&lt;/sentence&gt;&lt;brtype=&quot;automatic_original&quot;/&gt;&lt;/title&gt;&lt;/titleBlock&gt;lstlisting</subsection>
  <subsection title="コーパスデータベースの運用"/>
  <subsection title="コーパスのエクスポート">人手で修正を行った形態論情報は，元のXML文書にタグとして埋め込んだXML形式でエクスポートすることができる．BCCWJを構成する全てのXML文書（C-XML，M-XML）は，このデータベースから出力された．XMLエクスポート用のSQL文では，各テーブルを結合し，データベース内部でXML型のデータとして生成した後，ファイル出力している．これによりデータが整形式のXMLであることが保証される．テーブルの結合時には，6.1で示したインポートの流れを逆にたどる．この際，タグテーブルを参照するが，ルビや数字などの別テーブルで管理するタグはタグテーブルからではなく，それぞれのテーブルの情報を元にタグを再構成して出力する．当然ながら，表形式の形態論情報を出力することも可能であり，BCCWJを構成する表形式の形態論情報データ（短単位・長単位TSV）はこのデータベースから出力された．また，Webベースのコーパス検索ツール「中納言」のソースデータもここから出力されたものである．さらに，形態素解析辞書UniDicの機械学習に用いるコーパスも，コーパスデータベースの短単位テーブルの一部を出力したものである．なお，データベースに格納されている形態論情報は，インポート前の数字処理を経たテキストを元にしておりBCCWJのM-XMLおよび表形式の形態論情報データではこれを出力しているが，データベース上では原文に相当するC-XMLを元にして管理されているため，数字処理を行わない形でXML文書を取り出すことも可能な設計になっている．</subsection>
  <section title="クライアントツールの開発"/>
  <subsection title="辞書データベース用ツール「UniDic Explorer」">辞書管理ツール「UniDicExplorer」は辞書データベースへの見出し語の追加・修正をするために開発したクライアントツールである．ツール上にUniDicの見出し語の階層構造をそのまま可視化しており，階層構造を意識した辞書管理を可能にしている（図）．上段左の検索用コントロールで，各階層の見出し語の情報（語彙素・語彙素読み・語形・書字形・その他）を対象に見出し語表を検索すると，左ペインにマッチした語がUniDicの階層構造を反映したツリー形式で表示される．右ペインには各階層の見出し語が，階層構造を反映した重層的なフォームの形で表示される．見出し語の追加は，見出し語のテーブルのデータが表示されている画面から「新規」ボタンをクリックすることにより行う．見出し語表のデータベース制約により，見出し語は必ず親となる見出し語に追加する形で入力するよう制限されており，逆に見出し語を削除する場合には，その見出し語の子となっている見出し語をあらかじめ削除しておかなければならない．これによって見出し語表の階層構造の整合性を確保している．画面下部の「ツリーの操作」では，見出し語の移動・コピー・削除を行うことができる．この画面では，当該見出し語だけでなく，子や孫となる見出し語ツリー全体をまとめて処理することができる．見出し語は語彙表を介してコーパスと接続されているため，当該見出し語のコーパス中での用例をこのツールから確認することができる．当該語のコーパス中の頻度は右ペインの各階層の見出し語の部分に常に表示されている．頻度情報の横の「用例」ボタンを押下することで，当該語のコーパス中の用例を文脈付きで全て表示することができる．</subsection>
  <subsection title="コーパスデータベース用ツール「大納言」">短単位の自動解析精度はおおむね98%程度であった．長単位解析の精度も（短単位データが全て正解であることを前提として）99%ほどであり，人手による修正が必要であった．こうした形態論情報アノテーションの人手修正を行うためのツールが，「大納言」である（図）．「大納言」の中心となる機能は形態論情報の修正であるが，それ以外にも多くの機能を持つため，画面上段のタブによってモードや機能を切り替えて利用する形になっている．</subsection>
  <subsubsection title="文字とタグの修正機能">「大納言」では形態論情報そのものの修正作業のほかに，原テキストの文字修正，数字変換の誤り修正，ルビの文字修正を行う機能を実装した．6章で示したとおり，コーパスデータベースは文字ベースの開始終了IDで全体が関連付けられているが，「大納言」を通してこれらの修正を行うことで，作業者が意識することなく全体の関連付けの整合性を保つことができる．コーパス中の文字の修正では，文字テーブルを修正した後，文字修正テーブルに修正内容を記録する．自動数字変換（節参照）の修正では，タグ付けされた変換内容をもとに，変換処理を元に戻したり，適切な変換内容に人手で修正したりする機能を持たせた．数字を変換し直す場合には数字テーブル，形態論情報を修正する．タグの修正については，XML文書を極力整形式に保ったまま，直接修正できる機能を実装した．</subsubsection>
  <section title="おわりに">以上に述べた「形態論情報データベース」を開発することで，形態素解析された1億語規模のコーパスを格納し，その全体に対して形態論情報の修正処理を行うことを可能にした．これにより，約100万語のコアデータについて形態論情報に十分な人手修正を施し，それ以外の部分についても人手による修正を施して高い精度を達成することを可能にした．このシステムがBCCWJの形態論情報アノテーションを支え，BCCWJを構成する全てのデータはこのデータベースから出力された．また，本システムによってUniDicの見出し語のデータ整備を支援し，見出し語のデータと対応付けられた学習用コーパスを提供したことで形態素解析辞書UniDicの開発に貢献した．このデータベースシステムは，現在「日本語歴史コーパス」の構築に利用されているほか，BCCWJのタグ修正や新形式のデータ出力などメンテナンス作業の基盤としても活用されている．今後も大規模コーパスの構築を支えるシステムとして活用される予定である．なお，本システムは研究所内でのコーパス構築を目的に開発したものであり，そのままの形で一般公開を行う予定はないが，BCCWJの活用やコーパス開発のために本システムの利用を希望する場合には，プログラムの提供を含めて対応する用意があるので問い合わせてほしい．document</section>
</root>
